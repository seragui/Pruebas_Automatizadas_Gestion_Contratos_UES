{
	"info": {
		"_postman_id": "c2b87ce9-41c4-4d4d-8561-3dc29895e819",
		"name": "GESTION_CONTRATOS_SIN_CONTRATACION",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "42161334"
	},
	"item": [
		{
			"name": "LOGIN INICIALES",
			"item": [
				{
					"name": "LOGIN CORRECTO DIRECTOR",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.variables.set(\"login_role\", \"director\");",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"=== Login Director - ObtenciÃ³n de Token Para Pruebas ===\");\r",
									"pm.test(\"Login OK (200)\", () => pm.response.code === 200);\r",
									"\r",
									"const d = pm.response.json();\r",
									"const token =\r",
									"  d?.token ||\r",
									"  d?.access_token ||\r",
									"  d?.data?.token ||\r",
									"  d?.user?.api_token;\r",
									"\r",
									"pm.expect(token, \"No vino token en el body\").to.be.a(\"string\");\r",
									"pm.environment.set(\"token_director\", token);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"{{user_director}}\",\r\n  \"password\": \"{{pass_director}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "LOGIN CORRECTO ADMIN",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.variables.set(\"role\", \"admin\");",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"=== Login Administrador - ObtenciÃ³n de Token Para Pruebas ===\");\r",
									"pm.test(\"Login OK (200)\", () => pm.response.code === 200);\r",
									"\r",
									"const d = pm.response.json();\r",
									"const token =\r",
									"  d?.token ||\r",
									"  d?.access_token ||\r",
									"  d?.data?.token ||\r",
									"  d?.user?.api_token;\r",
									"\r",
									"pm.expect(token, \"No vino token en el body\").to.be.a(\"string\");\r",
									"pm.environment.set(\"token_admin\", token);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"{{user_admin}}\",\r\n  \"password\": \"{{pass_admin}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "LOGIN CORRECTO SECRETARIA",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.variables.set(\"role\", \"secretaria\");",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"=== Login Secretaria Asistente Administrativo - ObtenciÃ³n de Token Para Pruebas ===\");\r",
									"pm.test(\"Login OK (200)\", () => pm.response.code === 200);\r",
									"\r",
									"const d = pm.response.json();\r",
									"const token =\r",
									"  d?.token ||\r",
									"  d?.access_token ||\r",
									"  d?.data?.token ||\r",
									"  d?.user?.api_token;\r",
									"\r",
									"pm.expect(token, \"No vino token en el body\").to.be.a(\"string\");\r",
									"pm.environment.set(\"token_secretaria\", token);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"{{user_secretaria}}\",\r\n  \"password\": \"{{pass_secretaria}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "LOGIN CORRECTO RRHH",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.variables.set(\"role\", \"rrhh\");",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"=== Login Recursos Humanos - ObtenciÃ³n de Token Para Pruebas ===\");",
									"pm.test(\"Login OK (200)\", () => pm.response.code === 200);",
									"",
									"const d = pm.response.json();",
									"const token =",
									"  d?.token ||",
									"  d?.access_token ||",
									"  d?.data?.token ||",
									"  d?.user?.api_token;",
									"",
									"pm.expect(token, \"No vino token en el body\").to.be.a(\"string\");",
									"pm.environment.set(\"token_rrhh\", token);",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"{{user_rrhh}}\",\r\n  \"password\": \"{{pass_rrhh}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "LOGIN CORRECTO ADMIN2",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"=== Login Administrador Auxiliar - ObtenciÃ³n de Token Para Pruebas ===\");\r",
									"pm.test(\"Login OK (200)\", () => pm.response.code === 200);\r",
									"\r",
									"const d = pm.response.json();\r",
									"const token =\r",
									"  d?.token ||\r",
									"  d?.access_token ||\r",
									"  d?.data?.token ||\r",
									"  d?.user?.api_token;\r",
									"\r",
									"pm.expect(token, \"No vino token en el body\").to.be.a(\"string\");\r",
									"pm.environment.set(\"token_admin2\", token);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"{{user_admin2}}\",\r\n  \"password\": \"{{pass_admin2}}\"\r\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				}
			],
			"description": "# ðŸ“ Logins Iniciales\n\nEn esta carpeta se encuentran Ãºnicamente las solicitudes de login para los diferentes roles y recursos del sistema. Cada solicitud realiza la autenticaciÃ³n correspondiente y almacena el token obtenido en una variable de entorno, permitiendo su reutilizaciÃ³n en otras solicitudes de la colecciÃ³n.\n\nSolicitudes incluidas:\n\n- LOGIN CORRECTO DIRECTOR: AutenticaciÃ³n para el usuario con rol de Director.\n    \n- LOGIN CORRECTO ADMIN: AutenticaciÃ³n para el usuario Administrador principal.\n    \n- LOGIN CORRECTO SECRETARIA: AutenticaciÃ³n para el usuario con rol de SecretarÃ­a.\n    \n- LOGIN CORRECTO RRHH: AutenticaciÃ³n para el usuario de Recursos Humanos.\n    \n- LOGIN CORRECTO ADMIN2: AutenticaciÃ³n para el segundo usuario Administrador.\n    \n\nUso recomendado:\n\n1. Ejecuta la(s) solicitud(es) de login segÃºn el rol que vayas a utilizar.\n    \n2. El token obtenido se almacena automÃ¡ticamente en la variable de entorno correspondiente (por ejemplo: token_admin, token_director, etc.).\n    \n3. Utiliza estos tokens en las demÃ¡s solicitudes de la colecciÃ³n para acceder a los recursos protegidos segÃºn el rol.\n    \n\nNota:  \nNo agregues aquÃ­ solicitudes que no correspondan a autenticaciÃ³n inicial. Esta carpeta estÃ¡ pensada exclusivamente para centralizar los logins y la gestiÃ³n de tokens de acceso."
		},
		{
			"name": "USUARIOS",
			"item": [
				{
					"name": "CP_01 LOGIN SIN CORREO NI CONTRASEÃ‘A",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.environment.unset(\"token\");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"=== Caso de Prueba CP01: Iniciar SesiÃ³n ===\");\r",
									"console.log(\"=== Login sin Correo Ni ContraseÃ±a ===\");\r",
									"pm.test(\"401 Unauthorized\", () => pm.expect([401, 422]).to.include(pm.response.code));\r",
									"let d={}; try{ d=pm.response.json(); }catch(e){}\r",
									"pm.test(\"Mensaje genÃ©rico\", () => {\r",
									"  const msg = JSON.stringify(d).toLowerCase();\r",
									"  pm.expect(msg).to.match(/error|credenciales|no autorizado|unauthor/i);\r",
									"  pm.expect(msg).to.not.match(/usuario no existe|user does not exist/i);\r",
									"});\r",
									"pm.test(\"No devuelve token\", () => {\r",
									"  const hasToken = d?.access_token || d?.token || d?.data?.token || d?.api_token;\r",
									"  pm.expect(!!hasToken).to.eql(false);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text",
								"disabled": true
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text",
								"disabled": true
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"\",\r\n  \"password\": \"\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_01 LOGIN CON CONTRASEÃ‘A INCORRECTA",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.environment.unset(\"token\");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"=== Caso de Prueba CP01: Iniciar SesiÃ³n ===\");\r",
									"console.log(\"=== Login Con ContraseÃ±a Incorrecta ===\");\r",
									"pm.test(\"401 Unauthorized\", () => pm.expect([401, 422]).to.include(pm.response.code));\r",
									"let d={}; try{ d=pm.response.json(); }catch(e){}\r",
									"pm.test(\"Mensaje genÃ©rico\", () => {\r",
									"  const msg = JSON.stringify(d).toLowerCase();\r",
									"  pm.expect(msg).to.match(/error|credenciales|no autorizado|unauthor/i);\r",
									"  pm.expect(msg).to.not.match(/usuario no existe|user does not exist/i);\r",
									"});\r",
									"pm.test(\"No devuelve token\", () => {\r",
									"  const hasToken = d?.access_token || d?.token || d?.data?.token || d?.api_token;\r",
									"  pm.expect(!!hasToken).to.eql(false);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"{{user_prueba_login}}\",\r\n  \"password\": \"contraseÃ±a12345556\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_01 LOGIN CON CORREO INEXISTENTE",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.environment.unset(\"token\");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"=== Caso de Prueba CP01: Iniciar SesiÃ³n ===\");\r",
									"console.log(\"=== Login Con Correo Inexistente ===\");\r",
									"pm.test(\"401 Unauthorized\", () => pm.expect([401, 422]).to.include(pm.response.code));\r",
									"let d={}; try{ d=pm.response.json(); }catch(e){}\r",
									"pm.test(\"Mensaje genÃ©rico\", () => {\r",
									"  const msg = JSON.stringify(d).toLowerCase();\r",
									"  pm.expect(msg).to.match(/error|credenciales|no autorizado|unauthor/i);\r",
									"  pm.expect(msg).to.not.match(/usuario no existe|user does not exist/i);\r",
									"});\r",
									"pm.test(\"No devuelve token\", () => {\r",
									"  const hasToken = d?.access_token || d?.token || d?.data?.token || d?.api_token;\r",
									"  pm.expect(!!hasToken).to.eql(false);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"rsermeno@ues.edu.sv\",\r\n  \"password\": \"{{authPass}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_01 LOGIN CORRECTO",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"=== Caso de Prueba CP01: Iniciar SesiÃ³n ===\");\r",
									"console.log(\"=== Login Con Datos Correctos ===\");\r",
									"// ==== Asserts bÃ¡sicos\r",
									"pm.test(\"API RESPONDE EN 200/201 LOGIN\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"\r",
									"// ==== Parseo resiliente\r",
									"let d = {};\r",
									"try { d = pm.response.json(); } catch (e) {}\r",
									"\r",
									"// ==== Detecta rol: request.login_role > env.active_role > 'admin'\r",
									"const role = (pm.variables.get(\"login_role\") || pm.environment.get(\"active_role\") || \"admin\").toLowerCase();\r",
									"\r",
									"// ==== Picker de token (body/headers/cookies)\r",
									"function pickToken(respJson) {\r",
									"  const hAuth   = pm.response.headers.get(\"Authorization\");\r",
									"  const cookieT = pm.cookies.get(\"token\") || pm.cookies.get(\"auth_token\") || \"\";\r",
									"  if (respJson?.access_token)          return respJson.access_token;\r",
									"  if (respJson?.token)                 return respJson.token;\r",
									"  if (respJson?.data?.access_token)    return respJson.data.access_token;\r",
									"  if (respJson?.data?.token)           return respJson.data.token;\r",
									"  if (respJson?.meta?.token)           return respJson.meta.token;\r",
									"  if (respJson?.api_token)             return respJson.api_token;\r",
									"  if (respJson?.user?.api_token)       return respJson.user.api_token;\r",
									"  if (hAuth && /^Bearer\\s+/.test(hAuth)) return hAuth.replace(/^Bearer\\s+/,\"\").trim();\r",
									"  if (cookieT)                         return cookieT;\r",
									"  return \"\";\r",
									"}\r",
									"\r",
									"const token = pickToken(d);\r",
									"\r",
									"// ==== Debe existir token\r",
									"pm.test(`DEVUELVE TOKEN Y LO GUARDA POR ROL (${role})`, () => {\r",
									"  pm.expect(token, \"No se encontrÃ³ token en body/headers/cookies\").to.be.a(\"string\").and.not.empty;\r",
									"});\r",
									"\r",
									"// ==== TTL (si viene), default 3600s\r",
									"const ttl = d?.expires_in ? Number(d.expires_in) : 3600;\r",
									"const expMs = Date.now() + ttl * 1000;\r",
									"\r",
									"// ==== Guarda cache por rol\r",
									"pm.environment.set(`token_${role}`, token);\r",
									"pm.environment.set(`token_${role}_exp`, expMs.toString());\r",
									"\r",
									"// ==== (Opcional) Alias genÃ©rico: SOLO si tÃº lo decides.\r",
									"// ActÃ­valo poniendo en tu Environment: use_generic_token = true\r",
									"if ((pm.environment.get(\"use_generic_token\") || \"\").toString().toLowerCase() === \"true\") {\r",
									"  pm.environment.set(\"token\", token);\r",
									"}\r",
									"\r",
									"console.log(`[Login ${role.toUpperCase()}] Token_${role} guardado. Exp:`, new Date(expMs).toISOString());\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"{{user_prueba_login}}\",\r\n  \"password\": \"{{pass_prueba login}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_02 VERIFICAR ACCESO A RUTA PROTEGIDA",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"=== Caso de Prueba CP02: Logout invalida sesiÃ³n ===\");\r",
									"console.log(\"=== Prueba de Control Antes del Logout ===\");\r",
									"pm.test(\"Ruta protegida responde 403 con token\", () => pm.expect(pm.response.code).to.eql(403));\r",
									"pm.test(\"Se enviÃ³ Bearer\", () => {\r",
									"  const auth = pm.request.headers.get(\"Authorization\") || \"\";\r",
									"  pm.expect(auth).to.match(/^Bearer\\s+/);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_secretaria}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/escalafones",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"escalafones"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_02 LOGOUT (INVALIDA TOKEN ACTUAL)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"=== Caso de Prueba CP02: Logout invalida sesiÃ³n ===\");\r",
									"console.log(\"=== Se realiza Logout como parte de la prueba ===\");\r",
									"pm.test(\"Logout 200/204\", () => pm.expect([200,204]).to.include(pm.response.code));\r",
									"pm.test(\"Logout con Bearer presente\", () => {\r",
									"  const auth = pm.request.headers.get(\"Authorization\") || \"\";\r",
									"  pm.expect(auth).to.match(/^Bearer\\s+/);\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin2}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/auth/logout",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"logout"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_02 VERIFICAR QUE EL TOKEN YA NO ES VALIDO",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"=== Caso de Prueba CP02: Logout invalida sesiÃ³n ===\");\r",
									"console.log(\"=== Se realiza consulta a ruta protegida con token invalido ===\");\r",
									"pm.test(\"Acceso denegado con token invalidado\", () => {\r",
									"  pm.expect([401,403]).to.include(pm.response.code);\r",
									"});\r",
									"pm.test(\"Se estÃ¡ probando con el token viejo\", () => {\r",
									"  const auth = pm.request.headers.get(\"Authorization\") || \"\";\r",
									"  pm.expect(auth).to.match(/^Bearer\\s+/);\r",
									"});\r",
									"// Limpieza: ahora sÃ­, borramos el token del entorno\r",
									"pm.environment.unset(\"token\");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin2}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text",
								"disabled": true
							}
						],
						"url": {
							"raw": "{{base_url}}/escalafones",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"escalafones"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_02 LOGIN CORRECTO",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.variables.set(\"role\", \"admin\");"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"=== LOGIN DE CONTROL OBTENCION DE TOKEN ===\");\r",
									"pm.test(\"Login OK (200)\", () => pm.response.code === 200);\r",
									"\r",
									"const d = pm.response.json();\r",
									"const token =\r",
									"  d?.token ||\r",
									"  d?.access_token ||\r",
									"  d?.data?.token ||\r",
									"  d?.user?.api_token;\r",
									"\r",
									"pm.expect(token, \"No vino token en el body\").to.be.a(\"string\");\r",
									"pm.environment.set(\"token_admin\", token);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"{{user_admin2}}\",\r\n  \"password\": \"{{pass_admin2}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_03 CREAR USUARIO CORRECTO",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ID de corrida para evitar duplicados",
									"if (!pm.environment.get(\"RUN_ID\")) {",
									"  pm.environment.set(\"RUN_ID\", Date.now().toString(36));",
									"}",
									"const runId = pm.environment.get(\"RUN_ID\");",
									"",
									"// NÃºmero de iteraciÃ³n (si estÃ¡ disponible)",
									"const iteration = typeof pm.info.iteration !== 'undefined' ? pm.info.iteration : 0;",
									"",
									"// Sufijo aleatorio",
									"const randomSuffix = Math.random().toString(36).substring(2, 8);",
									"",
									"// Lista de nombres base",
									"const names = [",
									"  \"Fernando Ramiro Rivera Campos\",",
									"  \"Ana MarÃ­a LÃ³pez\",",
									"  \"Carlos PÃ©rez\",",
									"  \"LucÃ­a GÃ³mez\"",
									"];",
									"// Selecciona un nombre aleatorio y le agrega el runId",
									"const nameBase = names[Math.floor(Math.random() * names.length)];",
									"const name = `${nameBase} ${runId}`;",
									"",
									"// Email base",
									"const emailBase = \"fernando_rivera@ues.edu.sv\";",
									"const [local, domain] = emailBase.split(\"@\");",
									"const email = `${local}+${runId}_${iteration}_${randomSuffix}@${domain}`;",
									"",
									"// Resto del payload",
									"const role = \"Asistente Administrativo\";",
									"const payload = { name, email, role };",
									"pm.request.body.update(JSON.stringify(payload, null, 2));",
									"console.log(\"[CreateUser] payload ->\", payload);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Acepta 201 o 200 segÃºn tu implementaciÃ³n\r",
									"pm.test(\"201 Created (o 200)\", () => pm.expect([201,200]).to.include(pm.response.code));\r",
									"\r",
									"let d = {}; try { d = pm.response.json(); } catch(e) {}\r",
									"\r",
									"pm.test(\"Mensaje de Ã©xito\", () => {\r",
									"  pm.expect((d.message || \"\").toLowerCase()).to.include(\"usuario creado\");\r",
									"});\r",
									"\r",
									"pm.test(\"No expone password/token\", () => {\r",
									"  const s = JSON.stringify(d).toLowerCase();\r",
									"  pm.expect(s).to.not.match(/password|access_token|api_token|plain/i);\r",
									"});\r",
									"\r",
									"// Guarda id por si luego quieres limpiar o consultar\r",
									"const createdId = d.id || d.user?.id;\r",
									"if (createdId) pm.environment.set(\"createdUserId\", createdId);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/users",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_03 CREAR USUARIO CON DATOS INCORRECTOS",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Lee variables de iteraciÃ³n (Runner) o de entorno\r",
									"const name   = pm.iterationData.get('name')   ?? pm.variables.get('name');\r",
									"const email  = pm.iterationData.get('email')  ?? pm.variables.get('email');\r",
									"const role   = pm.iterationData.get('role')   ?? pm.variables.get('role');\r",
									"let schoolId = pm.iterationData.get('school_id');\r",
									"if (schoolId === \"\" || schoolId === null || schoolId === undefined) schoolId = undefined;\r",
									"\r",
									"const payload = { name, email, role };\r",
									"if (schoolId !== undefined) payload.school_id = schoolId; // no lo mandes si no viene\r",
									"\r",
									"pm.request.body.update(JSON.stringify(payload, null, 2));\r",
									"console.log(\"[NEG create user] payload =>\", payload);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Debe devolver 422 por validaciÃ³n\r",
									"pm.test(\"422 Unprocessable Entity (validaciÃ³n)\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(422);\r",
									"});\r",
									"\r",
									"// Estructura tÃ­pica de validaciÃ³n de Laravel\r",
									"let d = {};\r",
									"try { d = pm.response.json(); } catch (e) {}\r",
									"\r",
									"pm.test(\"Incluye objeto 'errors' con detalles\", () => {\r",
									"  pm.expect(d).to.have.property(\"errors\");\r",
									"});\r",
									"\r",
									"\r",
									"// No exponer informaciÃ³n sensible\r",
									"pm.test(\"No expone password ni tokens\", () => {\r",
									"  const s = JSON.stringify(d).toLowerCase();\r",
									"  pm.expect(s).to.not.match(/password|access_token|api_token|plain/i);\r",
									"});\r",
									"\r",
									"// No debe venir un id/usuario creado\r",
									"pm.test(\"No crea recurso (sin id en respuesta)\", () => {\r",
									"  pm.expect(d.id || (d.user && d.user.id)).to.be.oneOf([undefined, null, false]);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"Usuario Invalido\",\r\n  \"email\": \"usuario_invalido@ues.edu.sv\",\r\n  \"role\": \"Candidato\",\r\n  \"school_id\": \"no-num\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/users",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_03 CREAR USUARIO CON DATOS VACIOS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"422 Unprocessable Entity (datos vacÃ­os)\", () => pm.expect(pm.response.code).to.eql(422));\r",
									"\r",
									"let d = {}; try { d = pm.response.json(); } catch(e){}\r",
									"pm.test(\"Incluye 'errors' con campos requeridos\", () => {\r",
									"  pm.expect(d).to.have.property(\"errors\");\r",
									"  pm.expect(Object.keys(d.errors||{})).to.include.members([\"name\",\"email\",\"role\"]);\r",
									"});\r",
									"\r",
									"pm.test(\"No expone password/tokens\", () => {\r",
									"  const s = JSON.stringify(d).toLowerCase();\r",
									"  pm.expect(s).to.not.match(/password|access_token|api_token|plain/i);\r",
									"});\r",
									"pm.test(\"No crea recurso\", () => {\r",
									"  pm.expect(d.id || d.user?.id).to.be.oneOf([undefined,null,false]);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"\",\r\n  \"email\": \"\",\r\n  \"role\": \"\",\r\n  \"school_id\": \"\"\r\n}\r\n"
						},
						"url": {
							"raw": "{{base_url}}/users",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_04 ACTUALIZAR USUARIO EXISTENTE",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ---- helper para marcar defectos (sin perder el resto de aserciones)",
									"function defect(id, msg) {",
									"  console.warn(`[DEFECT ${id}] ${msg}`);",
									"  pm.test(`[DEFECT ${id}] ${msg}`, () => pm.expect.fail(msg));",
									"}",
									"",
									"// === VerificaciÃ³n de cÃ³digo ===",
									"pm.test(\"Status code es 200 o 201\", () => {",
									"  pm.expect([200, 201]).to.include(pm.response.code);",
									"});",
									"",
									"if (![200, 201].includes(pm.response.code)) {",
									"  defect(\"CP04-POS-200\", `Update deberÃ­a responder 200 o 201, pero devolviÃ³ ${pm.response.code}`);",
									"}",
									"",
									"// === VerificaciÃ³n de payload de respuesta ===",
									"let d = {};",
									"try { d = pm.response.json(); } catch(e) {}",
									"",
									"pm.test(\"Incluye 'user' en respuesta\", () => pm.expect(d).to.have.property(\"user\"));",
									"",
									"pm.test(\"Nombre/email actualizados\", () => {",
									"  pm.expect(d.user.name).to.eql(pm.environment.get(\"newName\"));",
									"  pm.expect((d.user.email || \"\").toLowerCase()).to.eql(pm.environment.get(\"newEmail\").toLowerCase());",
									"});",
									"",
									"pm.test(\"ID coincide con el solicitado\", () => {",
									"  pm.expect(String(d.user.id)).to.eql(String(pm.environment.get(\"userToUpdateId\")));",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Pre-request script para definir variables de entorno a partir del body",
									"try {",
									"    let body = pm.request.body && pm.request.body.raw ? pm.request.body.raw : '{}';",
									"    let data = JSON.parse(body);",
									"    if (data.name) pm.environment.set('newName', data.name);",
									"    if (data.email) pm.environment.set('newEmail', data.email);",
									"    // Extraer el ID del path de la URL",
									"    let userId = null;",
									"    let urlMatch = pm.request.url.toString().match(/\\/users\\/(\\d+)/);",
									"    if (urlMatch && urlMatch[1]) {",
									"        userId = urlMatch[1];",
									"        pm.environment.set('userToUpdateId', userId);",
									"    }",
									"} catch (e) {",
									"    console.warn('No se pudo definir variables automÃ¡ticamente:', e);",
									"}"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"Anne Sabrina Carpintero Rodriguez\",\r\n  \"email\": \"sabrina_carpintero_2895@ues.edu.sv\",\r\n  \"role\": \"Candidato\",\r\n  \"school_id\": 8\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/users/11",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"11"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_04 BLOQUEAR ACTUALIZACION CON CORREO EN USO",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ---- helper para marcar defectos y que queden en rojo en el reporte",
									"function defect(id, msg) {",
									"  console.warn(`[DEFECT ${id}] ${msg}`);",
									"  pm.test(`[DEFECT ${id}] ${msg}`, () => pm.expect.fail(msg));",
									"}",
									"",
									"// --- Estado actual vs especificaciÃ³n",
									"pm.test(\"Actual: status en [201, 422, 409]\", () => {",
									"  pm.expect([201,422,409]).to.include(pm.response.code);",
									"});",
									"",
									"// EspecificaciÃ³n: deberÃ­a ser 422 (o 409)",
									"if (![422,409].includes(pm.response.code)) {",
									"  defect(\"CP04-NEG-EMAIL-UNIQUE\", `Duplicado de email deberÃ­a responder 422/409, devolviÃ³ ${pm.response.code}`);",
									"}",
									"",
									"// --- VerificaciÃ³n de payload",
									"let d = {};",
									"try { d = pm.response.json(); } catch(e){}",
									"",
									"// Si devuelve 201, es un defecto: no debe actualizar con email duplicado",
									"if (pm.response.code === 201) {",
									"  defect(\"CP04-NEG-EMAIL-UPDATED\", \"El usuario fue actualizado con un correo duplicado, lo cual no debe ocurrir\");",
									"  pm.test(\"No debe actualizar el usuario con email duplicado\", () => {",
									"    pm.expect((d.user?.email || \"\").toLowerCase()).to.not.eql(pm.environment.get(\"dupEmail\").toLowerCase());",
									"  });",
									"}",
									"",
									"// Si devuelve 422 o 409, asegurar que el usuario NO fue actualizado con el correo duplicado",
									"if ([422,409].includes(pm.response.code)) {",
									"  pm.test(\"No se actualiza el usuario con email duplicado\", () => {",
									"    // Si la respuesta incluye el usuario, asegurar que el email no es el duplicado",
									"    if (d.user && d.user.email) {",
									"      pm.expect(d.user.email.toLowerCase()).to.not.eql(pm.environment.get(\"dupEmail\").toLowerCase());",
									"    }",
									"  });",
									"}",
									"",
									"// No exponer informaciÃ³n sensible",
									"pm.test(\"No expone password/tokens\", () => {",
									"  const s = JSON.stringify(d).toLowerCase();",
									"  pm.expect(s).to.not.match(/password|access_token|api_token|plain/i);",
									"});",
									"",
									"pm.test(\"Si existe, hay un mensaje de Ã©xito\", function () {",
									"    let json = pm.response.json();",
									"    if(json.message){",
									"        pm.expect(json.message.toLowerCase()).to.match(/exito|actualizad[oa]|success/);",
									"    }",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"Anne Sabrina Carpintero Rodriguez\",\r\n  \"email\": \"nacionalues@ues.edu.sv\",\r\n  \"role\": \"Candidato\",\r\n  \"school_id\": 8\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/users/11",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"11"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_04 BLOQUEAR ACTUALIZACION DATOS VACIOS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"function defect(id, msg) {\r",
									"  console.warn(`[DEFECT ${id}] ${msg}`);\r",
									"  pm.test(`[DEFECT ${id}] ${msg}`, () => pm.expect.fail(msg));\r",
									"}\r",
									"\r",
									"// Esperado: 422 (validaciÃ³n)\r",
									"pm.test(\"422 Unprocessable Entity (datos vacÃ­os)\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(422);\r",
									"});\r",
									"\r",
									"// Cuerpo: estructura de validaciÃ³n\r",
									"let d = {};\r",
									"try { d = pm.response.json(); } catch (e) {}\r",
									"\r",
									"pm.test(\"Incluye 'errors' con campos requeridos\", () => {\r",
									"  pm.expect(d).to.have.property(\"errors\");\r",
									"  pm.expect(Object.keys(d.errors || {})).to.include.members([\"name\",\"email\",\"role\"]);\r",
									"});\r",
									"\r",
									"// school_id vacÃ­o: segÃºn regla 'numeric' de tu backend, si lo envÃ­as vacÃ­o deberÃ­a fallar\r",
									"pm.test(\"Valida 'school_id' (si viene) como numÃ©rico\", () => {\r",
									"  // si el backend no reporta error para school_id, lo registramos como defecto menor\r",
									"  if (!d.errors || !(\"school_id\" in d.errors)) {\r",
									"    defect(\"CP04-NEG-EMPTY-SCHOOLID\",\r",
									"      \"school_id vacÃ­o deberÃ­a invalidarse (numeric), pero no aparece en 'errors'\");\r",
									"  }\r",
									"});\r",
									"\r",
									"// No exponer datos sensibles\r",
									"pm.test(\"No expone password/tokens\", () => {\r",
									"  const s = JSON.stringify(d).toLowerCase();\r",
									"  pm.expect(s).to.not.match(/password|access_token|api_token|plain/i);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"\",\r\n  \"email\": \"\",\r\n  \"role\": \"\",\r\n  \"school_id\": \"\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/users/7",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"7"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_04 BLOQUEAR ACTUALIZACION CON DATOS ERRONEOS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"422 por school_id no numÃ©rico\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(422);\r",
									"});\r",
									"\r",
									"let d={}; try{ d=pm.response.json(); }catch(e){}\r",
									"pm.test(\"Incluye error en 'school_id'\", () => {\r",
									"  pm.expect(d).to.have.property(\"errors\");\r",
									"  pm.expect(Object.keys(d.errors||{})).to.include(\"school_id\");\r",
									"});\r",
									"\r",
									"pm.test(\"No exponer datos sensibles\", () => {\r",
									"  const s = JSON.stringify(d).toLowerCase();\r",
									"  pm.expect(s).to.not.match(/password|access_token|api_token|plain/);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"Anne Sabrina Carpintero Rodriguez 1234\",\r\n  \"email\": \"no es correo\",\r\n  \"role\": \"Candidato\",\r\n  \"school_id\": 1\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/users/111",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"111"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_05 LISTAR USUARIOS CON USUSARIO CON PERMISOS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === GET /users â€¢ listar (mÃ­nimo) â€” Tests completos ===\r",
									"\r",
									"// 1) CÃ³digo de estado\r",
									"pm.test(\"200 OK\", () => pm.expect(pm.response.code).to.eql(200));\r",
									"\r",
									"// 2) Respuesta es un arreglo\r",
									"let data = [];\r",
									"try { data = pm.response.json(); } catch (e) {}\r",
									"pm.test(\"Devuelve un arreglo\", () => pm.expect(Array.isArray(data)).to.eql(true));\r",
									"\r",
									"// 3) Si hay elementos, validar estructura bÃ¡sica del primero\r",
									"if (Array.isArray(data) && data.length) {\r",
									"  const u = data[0];\r",
									"\r",
									"  pm.test(\"Campos pÃºblicos bÃ¡sicos presentes\", () => {\r",
									"    pm.expect(u).to.have.property(\"id\");\r",
									"    pm.expect(u).to.have.property(\"name\");\r",
									"    pm.expect(u).to.have.property(\"email\");\r",
									"  });\r",
									"\r",
									"  // (Opcional) Email con forma vÃ¡lida\r",
									"  pm.test(\"Email con formato vÃ¡lido (si viene)\", () => {\r",
									"    if (typeof u.email === \"string\") {\r",
									"      pm.expect(u.email).to.match(/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/);\r",
									"    } else {\r",
									"      pm.expect(true).to.eql(true); // no falla si no estÃ¡\r",
									"    }\r",
									"  });\r",
									"\r",
									"  // (Opcional informativo) Relaciones comunes\r",
									"  pm.test(\"Relaciones comunes (roles/school) si aplica\", () => {\r",
									"    // No obligatorio: solo informativo\r",
									"    pm.expect(true).to.eql(true);\r",
									"  });\r",
									"}\r",
									"\r",
									"// 4) Nunca exponer campos sensibles (bÃºsqueda por clave exacta, no subcadenas)\r",
									"function hasForbiddenKeys(obj, forbidden) {\r",
									"  if (obj && typeof obj === \"object\") {\r",
									"    if (Array.isArray(obj)) {\r",
									"      for (const v of obj) if (hasForbiddenKeys(v, forbidden)) return true;\r",
									"    } else {\r",
									"      for (const k of Object.keys(obj)) {\r",
									"        if (forbidden.includes(String(k).toLowerCase())) return true;\r",
									"        if (hasForbiddenKeys(obj[k], forbidden)) return true;\r",
									"      }\r",
									"    }\r",
									"  }\r",
									"  return false;\r",
									"}\r",
									"\r",
									"pm.test(\"No expone campos sensibles (password/tokens)\", () => {\r",
									"  const forbidden = [\"password\", \"remember_token\", \"access_token\", \"api_token\", \"plain_password\"];\r",
									"  pm.expect(hasForbiddenKeys(data, forbidden)).to.eql(false);\r",
									"});\r",
									"\r",
									"// 5) (Opcional) TamaÃ±o razonable del payload (sanity check)\r",
									"pm.test(\"Payload JSON vÃ¡lido (sanity)\", () => {\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\") || \"\").to.match(/application\\/json/i);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/users",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_05 LISTAR USUARIOS CON USUARIO SIN PERMISO",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === GET /users (SIN permisos) â€” Tests ===\r",
									"\r",
									"// 1) CÃ³digo de estado esperado\r",
									"pm.test(\"403/401 sin permisos\", () => {\r",
									"  pm.expect([403, 401]).to.include(pm.response.code);\r",
									"});\r",
									"\r",
									"// 2) No debe retornar listado ni meta de paginaciÃ³n\r",
									"let raw = {};\r",
									"try { raw = pm.response.json(); } catch (e) {}\r",
									"\r",
									"const hasList = Array.isArray(raw) ||\r",
									"                Array.isArray(raw?.data) ||\r",
									"                Array.isArray(raw?.users);\r",
									"\r",
									"pm.test(\"No retorna arreglo de usuarios\", () => {\r",
									"  pm.expect(hasList).to.eql(false);\r",
									"});\r",
									"\r",
									"pm.test(\"No retorna meta de paginaciÃ³n\", () => {\r",
									"  pm.expect(!!raw?.meta).to.eql(false);\r",
									"});\r",
									"\r",
									"// 3) Mensaje de error legible (opcional)\r",
									"pm.test(\"Mensaje de error presente (opcional)\", () => {\r",
									"  const s = (raw?.message || pm.response.text() || \"\").toLowerCase();\r",
									"  pm.expect(s.length).to.be.greaterThan(0);\r",
									"});\r",
									"\r",
									"// 4) No exponer datos sensibles en error\r",
									"function hasForbiddenKeys(obj, forbidden) {\r",
									"  if (obj && typeof obj === \"object\") {\r",
									"    if (Array.isArray(obj)) { for (const v of obj) if (hasForbiddenKeys(v, forbidden)) return true; }\r",
									"    else {\r",
									"      for (const k of Object.keys(obj)) {\r",
									"        if (forbidden.includes(String(k).toLowerCase())) return true;\r",
									"        if (hasForbiddenKeys(obj[k], forbidden)) return true;\r",
									"      }\r",
									"    }\r",
									"  }\r",
									"  return false;\r",
									"}\r",
									"pm.test(\"Error sin campos sensibles\", () => {\r",
									"  const forbidden = [\"password\",\"remember_token\",\"access_token\",\"api_token\",\"plain_password\"];\r",
									"  pm.expect(hasForbiddenKeys(raw, forbidden)).to.eql(false);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_rrhh}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/users",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_07 LOGIN CANDIDATO",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Login OK (200)\", () => pm.response.code === 200);",
									"",
									"if (pm.response.code === 200) {",
									"    const d = pm.response.json();",
									"    const token =",
									"        d?.token ||",
									"        d?.access_token ||",
									"        d?.data?.token ||",
									"        d?.user?.api_token;",
									"",
									"    pm.expect(token, \"No vino token en el body\").to.be.a(\"string\");",
									"    pm.environment.set(\"token_candidato\", token);",
									"} else {",
									"    console.log(\"Login failed: status code \" + pm.response.code);",
									"    // Token assertion skipped",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.variables.set(\"role\", \"candidato\");"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"{{user_candidato}}\",\r\n  \"password\": \"{{pass_candidato}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_07 OBTENER CANDIDATOS SIN PERMISO",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Forzamos a usar el token del rol Candidato\r",
									"pm.variables.set(\"active_role\", \"candidato\");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status es 401 o 403 (bloqueado para Candidato)\", () => {\r",
									"  pm.expect([401, 403]).to.include(pm.response.code);\r",
									"});\r",
									"\r",
									"// Mensaje razonable (opcional)\r",
									"pm.test(\"Mensaje indica falta de permisos\", () => {\r",
									"  const body = pm.response.text().toLowerCase();\r",
									"  pm.expect(body).to.match(/unauth|forbid|permiso|no autorizado/);\r",
									"});\r",
									"\r",
									"// No debe venir arreglo de datos\r",
									"pm.test(\"No devuelve listado de candidatos\", () => {\r",
									"  const d = pm.response.json();\r",
									"  // si el backend devuelve objeto con 'data', verificamos que NO sea array con elementos\r",
									"  if (d && typeof d === 'object' && 'data' in d) {\r",
									"    pm.expect(Array.isArray(d.data) && d.data.length === 0).to.eql(true);\r",
									"  }\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/candidates/all",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"candidates",
								"all"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_07 OBTENER CARGOS SIN PERMISO",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Forzamos a usar el token del rol Candidato\r",
									"pm.variables.set(\"active_role\", \"candidato\");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status es 401 o 403 (bloqueado para Candidato)\", () => {\r",
									"  pm.expect([401, 403]).to.include(pm.response.code);\r",
									"});\r",
									"\r",
									"// Mensaje razonable (opcional)\r",
									"pm.test(\"Mensaje indica falta de permisos\", () => {\r",
									"  const body = pm.response.text().toLowerCase();\r",
									"  pm.expect(body).to.match(/unauth|forbid|permiso|no autorizado/);\r",
									"});\r",
									"\r",
									"// No debe venir arreglo de datos\r",
									"pm.test(\"No devuelve listado de candidatos\", () => {\r",
									"  const d = pm.response.json();\r",
									"  // si el backend devuelve objeto con 'data', verificamos que NO sea array con elementos\r",
									"  if (d && typeof d === 'object' && 'data' in d) {\r",
									"    pm.expect(Array.isArray(d.data) && d.data.length === 0).to.eql(true);\r",
									"  }\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_secretaria}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/positions",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"positions"
							]
						}
					},
					"response": []
				}
			],
			"description": "# ðŸ“**USUARIOS**\n\nEsta carpeta contiene todas las solicitudes relacionadas con la gestiÃ³n y operaciones de usuarios en el sistema. Incluye autenticaciÃ³n, verificaciÃ³n y expiraciÃ³n de tokens, actualizaciÃ³n de datos de usuario, cierre de sesiÃ³n, y otras operaciones relevantes para el ciclo de vida de los usuarios.\n\nPrincipales operaciones incluidas:\n\n- AutenticaciÃ³n de usuarios (login) y obtenciÃ³n de tokens.\n    \n- VerificaciÃ³n de validez y expiraciÃ³n de tokens.\n    \n- ActualizaciÃ³n de informaciÃ³n de usuarios existentes.\n    \n- Cierre de sesiÃ³n (logout) e invalidaciÃ³n de tokens.\n    \n- Otras operaciones relacionadas con la administraciÃ³n y pruebas de usuarios.\n    \n\nRecomendaciones de uso:\n\n1. Realiza la autenticaciÃ³n con la solicitud de login correspondiente para obtener el token de acceso.\n    \n2. Utiliza el token almacenado en las variables de entorno para ejecutar las solicitudes protegidas.\n    \n3. Actualiza la informaciÃ³n de usuario segÃºn sea necesario utilizando los endpoints de actualizaciÃ³n.\n    \n4. Verifica la validez de los tokens para pruebas de seguridad y expiraciÃ³n.\n    \n5. Utiliza la solicitud de logout para cerrar sesiÃ³n e invalidar el token actual.\n    \n\nNotas:\n\n- AsegÃºrate de tener configuradas las variables de entorno necesarias (por ejemplo, tokens y credenciales de usuario) antes de ejecutar las solicitudes.\n    \n- Esta carpeta estÃ¡ destinada exclusivamente a operaciones relacionadas con usuarios y autenticaciÃ³n. No agregues aquÃ­ endpoints que no correspondan a la gestiÃ³n de usuarios."
		},
		{
			"name": "SEGURIDAD",
			"item": [
				{
					"name": "CP_97 LOGIN CANDIDATO A",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Login 200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));",
									"let j = {};",
									"try { j = pm.response.json(); } catch(e){}",
									"const tk = j.access_token || j.token || j?.data?.token;",
									"pm.test(\"Token presente\", ()=> pm.expect(tk).to.be.a(\"string\").and.not.empty);",
									"pm.environment.set(\"token_candidatoA\", tk);",
									"",
									"// Captura el id del usuario autenticado",
									"const userId = j.user && j.user.id;",
									"pm.test(\"ID de usuario presente\", () => pm.expect(userId).to.be.a(\"number\"));",
									"pm.environment.set(\"candidatoA_id\", userId);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{ \"email\": \"{{candidatoA_user}}\", \"password\": \"{{candidatoA_pass}}\" }\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP 97 YO MISMO PRUEBA DE CONTROL",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.expect(pm.response.code).to.equal(200));",
									"",
									"// extrae la persona",
									"const data = pm.response.json();",
									"const p = data.person || data;",
									"",
									"// IDs esperados desde /users/me",
									"const myUserId   = Number(pm.environment.get(\"my_user_id\"));",
									"const myPersonId = Number(pm.environment.get(\"my_person_id\"));",
									"const candidatoAId = Number(pm.environment.get(\"candidatoA_id\"));",
									"",
									"// 1) Â¿Estoy viendo mi propia persona?",
									"if (myPersonId) {",
									"  pm.test(\"Es MI person_id\", () => pm.expect(Number(p.id)).to.equal(myPersonId));",
									"}",
									"if (p.user_id && myUserId) {",
									"  pm.test(\"Pertenece a MI user_id\", () => pm.expect(Number(p.user_id)).to.equal(myUserId));",
									"}",
									"",
									"// 1.1) Â¿user_id coincide con candidatoA_id?",
									"if (p.user_id && candidatoAId) {",
									"  pm.test(\"user_id coincide con candidatoA_id\", () => pm.expect(Number(p.user_id)).to.equal(candidatoAId));",
									"}",
									"",
									"// 2) Seguridad: no debe incluir secretos",
									"pm.test(\"Sin secretos en respuesta\", () => {",
									"  const t = pm.response.text();",
									"  pm.expect(t).to.not.match(/\"password|token|api_key|authorization\"/i);",
									"});",
									"",
									"// 3) Headers de seguridad",
									"pm.test(\"X-Content-Type-Options: nosniff\", () => {",
									"  pm.expect(pm.response.headers.get(\"X-Content-Type-Options\")).to.match(/nosniff/i);",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_candidatoA}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/persons/me",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"persons",
								"me"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_97 INTENTO DE LEER A OTRO USUARIO",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"403 Forbidden\", ()=> pm.expect(pm.response.code).to.equal(403));\r",
									"\r",
									"// No fuga de datos del ajeno\r",
									"const t = pm.response.text();\r",
									"pm.test(\"Sin datos sensibles\", () => {\r",
									"  pm.expect(t).to.not.match(/\"email\"\\s*:/i);\r",
									"  pm.expect(t).to.not.match(/\"document|dui|telefono|address|password|token/i);\r",
									"});\r",
									"\r",
									"// Headers seguridad\r",
									"pm.test(\"X-Content-Type-Options: nosniff\", () => {\r",
									"  pm.expect(pm.response.headers.get(\"X-Content-Type-Options\")).to.match(/nosniff/i);\r",
									"});\r",
									"pm.test(\"Content-Type JSON\", () => {\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\")).to.match(/application\\/json/i);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_candidatoA}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/persons/110",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"persons",
								"110"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_98 ACCESO NO AUTORIZADO A EDITAR RECURSO AJENO",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Debe devolver 403/401/404/405\", () =>\r",
									"  pm.expect([403,401,404,405]).to.include(pm.response.code)\r",
									");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_candidatoA}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{ \"first_name\": \"HACKED_{{RUN_ID}}\" }\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/persons/112",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"persons",
								"112"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_99 CREAR ACTIVIDAD CON CODIGO MALICIOSO",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Genera un payload XSS Ãºnico usando la marca de tiempo",
									"const timestamp = Date.now();",
									"const uniquePayload = `<img src=xx onerror=alert(1)>_${timestamp}`;",
									"pm.variables.set(\"xss_payload\", uniquePayload);",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === Test XSS: Backend debe bloquear o sanitizar cÃ³digo malicioso (XSS) ===",
									"",
									"// 1) Esperar un cÃ³digo de error (400, 422, 403) o, si es Ã©xito, validar que el valor devuelto en 'name' NO sea igual al payload malicioso",
									"const payload = pm.variables.get(\"xss_payload\") || \"\";",
									"let j = {};",
									"try { j = pm.response.json(); } catch(e) {}",
									"const stored = j.name || j.comment || j.note || j.activity?.name || j.data?.name || \"\";",
									"",
									"pm.test(\"El backend bloquea o sanitiza el cÃ³digo malicioso (XSS)\", function () {",
									"    // Si la respuesta es error esperado, pasa",
									"    if ([400, 403, 422].includes(pm.response.code)) {",
									"        pm.expect(true, `El backend rechazÃ³ el payload con status ${pm.response.code}`).to.be.true;",
									"    } else {",
									"        // Si la respuesta es exitosa, el valor devuelto NO debe ser igual al payload malicioso",
									"        pm.expect(stored, \"El backend NO debe aceptar ni almacenar el payload malicioso tal cual\").to.not.eql(payload);",
									"    }",
									"});",
									"",
									"const id = j.id || j.activity?.id || j.data?.id || j.result?.id;",
									"if (id) pm.environment.set(\"xss_item_id\", id);",
									"",
									"// (Opcional) Otros tests Ãºtiles pueden mantenerse aquÃ­, pero el test principal es el anterior."
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"{{xss_payload}}\"\r\n}"
						},
						"url": {
							"raw": "{{base_url}}/activities",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"activities"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_99 OBTENER ACTIVIDAD INGRESADA",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Test para asegurar que el valor devuelto ('stored') no contiene etiquetas HTML peligrosas",
									"pm.test(\"El valor 'name' no contiene etiquetas HTML\", function () {",
									"    var jsonData = pm.response.json();",
									"    var nameValue = jsonData.name || \"\";",
									"    // ExpresiÃ³n regular para detectar cualquier etiqueta HTML",
									"    var htmlTagRegex = /<[^>]+>/g;",
									"    pm.expect(htmlTagRegex.test(nameValue)).to.be.false;",
									"});",
									"",
									"// Test adicional para asegurar que el valor 'stored' no contiene etiquetas HTML",
									"pm.test(\"El valor 'stored' no contiene etiquetas HTML\", function () {",
									"    var jsonData = pm.response.json();",
									"    var storedValue = jsonData.stored || \"\";",
									"    var htmlTagRegex = /<[^>]+>/g;",
									"    pm.expect(htmlTagRegex.test(storedValue)).to.be.false;",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{base_url}}/activities/{{xss_item_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"activities",
								"{{xss_item_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_101 CORS RESTRICTIVO",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"OPTIONS 200/204\", () => pm.expect([200,204]).to.include(pm.response.code));\r",
									"\r",
									"// En origen NO permitido, el servidor NO debe devolver ACAO vÃ¡lido:\r",
									"const acao = pm.response.headers.get(\"Access-Control-Allow-Origin\");\r",
									"pm.test(\"Sin Access-Control-Allow-Origin (bloqueo por navegador)\", () => {\r",
									"  pm.expect(acao || \"\").to.equal(\"\");\r",
									"});\r",
									"\r",
									"// Si el server responde con ACAO: * y usas credenciales/Authorization => es riesgoso\r",
									"pm.test(\"No debe haber ACAO: * junto a Authorization\", () => {\r",
									"  pm.expect(acao).to.not.equal(\"*\");\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"packages": {},
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "OPTIONS",
						"header": [
							{
								"key": "Origin",
								"value": "https://otro_entorno.local",
								"type": "text"
							},
							{
								"key": "Access-Control-Request-Method",
								"value": "GET",
								"type": "text"
							},
							{
								"key": "Access-Control-Request-Method",
								"value": "Authorization, Content-Type",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_45 SQLi - CREATE (POSITIVO MALICIOSO)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.environment.set(\"token\", pm.environment.get(\"token_admin\"));\r",
									"\r",
									"// === Config rÃ¡pido (puedes cambiarlo en Variables del request o Environment) ===\r",
									"// payload_set: 'all' | 'sqli' | 'xss'\r",
									"const payloadSet = (pm.variables.get(\"payload_set\") || pm.environment.get(\"payload_set\") || \"all\").toLowerCase();\r",
									"// payload_strategy: 'runner' | 'secuencial' | 'random'\r",
									"const strategy = (pm.variables.get(\"payload_strategy\") || pm.environment.get(\"payload_strategy\") || \"runner\").toLowerCase();\r",
									"// payload_override: si defines un valor aquÃ­, se usarÃ¡ ese string exacto\r",
									"const override = pm.variables.get(\"payload_override\") || pm.environment.get(\"payload_override\") || \"\";\r",
									"\r",
									"// === CatÃ¡logo de payloads ===\r",
									"const SQLI = [\r",
									"  \"' OR 1=1 --\",\r",
									"  \"\\\" OR 1=1 --\",\r",
									"  \"admin' --\",\r",
									"  \"') OR ('1'='1\",\r",
									"  \"0' UNION SELECT NULL,NULL --\",\r",
									"  \"1); SELECT pg_sleep(3); --\"\r",
									"];\r",
									"\r",
									"const XSS = [\r",
									"  \"<script>alert('XSS')</script>\",\r",
									"  \"<img src=x onerror=alert('XSS')>\",\r",
									"  \"<svg/onload=alert(1)>\",\r",
									"  \"\\\"><svg/onload=alert(1)>\"\r",
									"];\r",
									"\r",
									"// Mezcla segÃºn set\r",
									"let pool = [];\r",
									"if (payloadSet === \"sqli\") pool = SQLI;\r",
									"else if (payloadSet === \"xss\") pool = XSS;\r",
									"else pool = SQLI.concat(XSS); // 'all'\r",
									"\r",
									"// --- Si hay override, Ãºsalo directamente ---\r",
									"if (override) {\r",
									"  pm.variables.set(\"payload\", override);\r",
									"  pm.variables.set(\"payload_name\", \"override\");\r",
									"} else {\r",
									"  // SelecciÃ³n por estrategia\r",
									"  const N = pool.length;\r",
									"  let idx = 0;\r",
									"\r",
									"  if (strategy === \"runner\") {\r",
									"    // Usa el Ã­ndice de iteraciÃ³n del Runner (0,1,2...) para ir recorriendo\r",
									"    idx = (pm.info.iteration || 0) % N;\r",
									"  } else if (strategy === \"random\") {\r",
									"    idx = Math.floor(Math.random() * N);\r",
									"  } else { // 'secuencial' por defecto si no es 'runner' ni 'random'\r",
									"    // Guarda y avanza un puntero en variables locales del request\r",
									"    const curr = Number(pm.variables.get(\"payload_ptr\") || 0);\r",
									"    idx = curr % N;\r",
									"    pm.variables.set(\"payload_ptr\", String(curr + 1));\r",
									"  }\r",
									"\r",
									"  const value = pool[idx];\r",
									"  pm.variables.set(\"payload\", value);\r",
									"  pm.variables.set(\"payload_name\", `${payloadSet}:${idx}`);\r",
									"}\r",
									"\r",
									"// (Opcional) Asegura headers JSON en este request\r",
									"try { pm.request.headers.remove('Accept'); } catch(e){}\r",
									"try { pm.request.headers.remove('Content-Type'); } catch(e){}\r",
									"pm.request.headers.add({ key: 'Accept', value: 'application/json' });\r",
									"if (['POST','PUT','PATCH'].includes(pm.request.method)) {\r",
									"  pm.request.headers.add({ key: 'Content-Type', value: 'application/json' });\r",
									"}\r",
									"\r",
									"// Debug en consola\r",
									"console.log(\"[CP_45] payload_set=\", payloadSet, \"strategy=\", strategy, \"payload=\", pm.variables.get(\"payload\"));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status controlado (422/400/403/401/200/201)\", () => {\r",
									"  pm.expect([200,201,400,401,403,404,422]).to.include(pm.response.code);\r",
									"});\r",
									"pm.test(\"Sin trazas SQL ni stack\", () => {\r",
									"  pm.expect(pm.response.text()).to.not.match(/SQLSTATE|syntax error|PDOException|Stack trace|vendor\\/laravel/i);\r",
									"});\r",
									"pm.test(\"JSON vÃ¡lido o error controlado\", () => {\r",
									"  try { pm.response.json(); pm.expect(true).to.be.true; } catch(e){ pm.expect([400,401,403,404,422]).to.include(pm.response.code); }\r",
									"});\r",
									"pm.test(\"Tiempo < 2s (evita time-based)\", () => pm.expect(pm.response.responseTime).to.be.below(2000));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{ \"name\": \"{{payload}}\", \"email\": \"victim_{{RUN_ID}}@test.local\", \"role\": \"Candidato\", \"school_id\": 1 }\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/users/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								""
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_45 SQLi â€“ UPDATE (PAYLOAD MALICIOSO)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.environment.set(\"token\", pm.environment.get(\"token_admin\"));\r",
									"\r",
									"// Lista de payloads (ajÃºstala a lo que necesites)\r",
									"const list = [\r",
									"  \"' OR 1=1 --\",\r",
									"  \"\\\" OR 1=1 --\",\r",
									"  \"admin' --\",\r",
									"  \"<script>alert('XSS')</script>\",\r",
									"  \"<img src=x onerror=alert('XSS')>\",\r",
									"  \"<svg/onload=alert(1)>\"\r",
									"];\r",
									"\r",
									"// ObtÃ©n nÃºmero de iteraciÃ³n actual (0,1,2...) del Runner\r",
									"const i = pm.info.iteration || 0;\r",
									"// Selecciona en ciclo\r",
									"const p = list[i % list.length];\r",
									"\r",
									"// Setea la variable para esta ejecuciÃ³n\r",
									"pm.variables.set(\"payload\", p);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status controlado (422/400/403/401/200/201)\", () => {\r",
									"  pm.expect([200,201,400,401,403,404,422]).to.include(pm.response.code);\r",
									"});\r",
									"pm.test(\"Sin trazas SQL ni stack\", () => {\r",
									"  pm.expect(pm.response.text()).to.not.match(/SQLSTATE|syntax error|PDOException|Stack trace|vendor\\/laravel/i);\r",
									"});\r",
									"pm.test(\"JSON vÃ¡lido o error controlado\", () => {\r",
									"  try { pm.response.json(); pm.expect(true).to.be.true; } catch(e){ pm.expect([400,401,403,404,422]).to.include(pm.response.code); }\r",
									"});\r",
									"pm.test(\"Tiempo < 2s (evita time-based)\", () => pm.expect(pm.response.responseTime).to.be.below(2000));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{ \"name\": \"{{payload}}\", \"email\": \"victim_{{RUN_ID}}@test.local\", \"role\": \"Candidato\", \"school_id\": 1 }\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/users/131",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"131"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_45 XSS ALMACENADO â€“ CREATE CON HTML",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const XSS = [",
									"  \"<script>alert('XSS')</script>\",",
									"  \"<img src=x onerror=alert('XSS')>\",",
									"  \"<svg/onload=alert(1)>\",",
									"  \"'\\\"><svg/onload=alert(1)>\",",
									"  \"<a href=javascript:alert(1)>link</a>\",",
									"  '<div style=\"x:expression(alert(1))\">x</div>'",
									"];",
									"const i = pm.info.iteration || 0;",
									"// Generar un sufijo Ãºnico por iteraciÃ³n para evitar duplicados",
									"const uniqueSuffix = Date.now() + '_' + Math.floor(Math.random() * 10000) + '_' + i;",
									"const dynamicPayload = XSS[i % XSS.length] + '_' + uniqueSuffix;",
									"pm.variables.set(\"payload\", dynamicPayload);",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status controlado (201/200/422)\", () => pm.expect([201,200,422]).to.include(pm.response.code));\r",
									"pm.test(\"Respuesta no devuelve HTML activo\", () => {\r",
									"  const t = pm.response.text();\r",
									"  pm.expect(t).to.not.match(/<script>|onerror=|onload=|javascript:/i);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"{{payload}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/activities",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"activities"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_102 API CABECERAS DE SEGURIDAD",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === CP_102: VerificaciÃ³n de cabeceras de seguridad (mejorado) ===",
									"// Solo ejecuta los tests si la respuesta es exitosa (200 o 201)",
									"const status = pm.response.code;",
									"const isSuccess = [200, 201].includes(status);",
									"",
									"// Helper para leer cabeceras (case-insensitive)",
									"const H = (k) => (pm.response.headers.get(k) || \"\");",
									"",
									"if (isSuccess) {",
									"  // 1) X-Content-Type-Options debe ser 'nosniff'",
									"  pm.test(\"[Seguridad] X-Content-Type-Options debe ser 'nosniff'\", () => {",
									"    const value = H(\"X-Content-Type-Options\");",
									"    pm.expect(value, `Falta o incorrecto: X-Content-Type-Options='${value}'`).to.match(/^nosniff$/i);",
									"  });",
									"",
									"  // 2) X-Frame-Options debe ser DENY o SAMEORIGIN",
									"  pm.test(\"[Seguridad] X-Frame-Options seguro (DENY/SAMEORIGIN)\", () => {",
									"    const value = H(\"X-Frame-Options\");",
									"    pm.expect([\"DENY\", \"SAMEORIGIN\"], `Falta o incorrecto: X-Frame-Options='${value}'`).to.include(value.toUpperCase());",
									"  });",
									"",
									"  // 3) Referrer-Policy segura (valores recomendados)",
									"  pm.test(\"[Seguridad] Referrer-Policy segura\", () => {",
									"    const value = H(\"Referrer-Policy\");",
									"    const valid = [",
									"      \"no-referrer\",",
									"      \"no-referrer-when-downgrade\",",
									"      \"same-origin\",",
									"      \"origin\",",
									"      \"strict-origin\",",
									"      \"origin-when-cross-origin\",",
									"      \"strict-origin-when-cross-origin\"",
									"    ];",
									"    pm.expect(valid, `Falta o incorrecto: Referrer-Policy='${value}'`).to.include(value.toLowerCase());",
									"  });",
									"",
									"  // 4) HSTS activo en HTTPS: Strict-Transport-Security con max-age",
									"  if (pm.request.url.toString().startsWith(\"https://\")) {",
									"    pm.test(\"[Seguridad] HSTS presente (Strict-Transport-Security)\", () => {",
									"      const value = H(\"Strict-Transport-Security\");",
									"      pm.expect(value, `Falta o incorrecto: Strict-Transport-Security='${value}'`).to.match(/max-age=\\d+/i);",
									"    });",
									"  }",
									"",
									"  // 5) CSP presente y sin comodines peligrosos",
									"  pm.test(\"[Seguridad] Content-Security-Policy presente y robusta\", () => {",
									"    const csp = H(\"Content-Security-Policy\");",
									"    pm.expect(csp.length, \"Falta la cabecera Content-Security-Policy\").to.be.greaterThan(0);",
									"    pm.expect(csp, \"CSP contiene comodines inseguros: script-src *\").to.not.match(/script-src\\s+\\*/i);",
									"    pm.expect(csp, \"CSP contiene 'unsafe-eval'\").to.not.match(/'unsafe-eval'/i);",
									"    pm.expect(csp, \"CSP contiene 'unsafe-inline'\").to.not.match(/'unsafe-inline'/i);",
									"  });",
									"",
									"  // 6) Cabeceras adicionales: solo comprobamos presencia si existen",
									"  [",
									"    \"Permissions-Policy\",",
									"    \"Cross-Origin-Opener-Policy\",",
									"    \"Cross-Origin-Embedder-Policy\",",
									"    \"Cross-Origin-Resource-Policy\"",
									"  ].forEach(h => {",
									"    const v = H(h);",
									"    if (v) {",
									"      pm.test(`[Seguridad] ${h} presente`, () => {",
									"        pm.expect(v.length, `La cabecera ${h} estÃ¡ vacÃ­a`).to.be.greaterThan(0);",
									"      });",
									"    }",
									"  });",
									"",
									"  // 7) VerificaciÃ³n anti CORS laxo: no usar ACAO:* con credenciales",
									"  pm.test(\"[Seguridad] CORS: Access-Control-Allow-Origin no debe ser '*' si hay credenciales\", () => {",
									"    const acao = H(\"Access-Control-Allow-Origin\");",
									"    const acc = H(\"Access-Control-Allow-Credentials\");",
									"    if (acc.toLowerCase() === \"true\") {",
									"      pm.expect(acao, \"CORS laxo: ACAO='*' y credenciales true\").to.not.equal(\"*\");",
									"    }",
									"  });",
									"",
									"} else {",
									"  pm.test(`[INFO] Tests de cabeceras omitidos: status ${status}` , () => {",
									"    pm.expect(isSuccess, `Respuesta no exitosa: status ${status}`).to.be.true;",
									"  });",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/users",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users"
							]
						}
					},
					"response": []
				}
			],
			"description": "# Carpeta: SEGURIDAD\n\n## IntroducciÃ³n\n\nLa carpeta **SEGURIDAD** agrupa los endpoints relacionados con la gestiÃ³n de la seguridad y el control de acceso dentro de la API. EstÃ¡ orientada tanto a desarrolladores que consumen la API como a quienes la mantienen, proporcionando operaciones clave para la autenticaciÃ³n, autorizaciÃ³n y administraciÃ³n de usuarios y roles.\n\n## Objetivos\n\n- Centralizar los endpoints de autenticaciÃ³n y autorizaciÃ³n.\n    \n- Facilitar la gestiÃ³n de usuarios, roles y permisos.\n    \n- Proveer mecanismos para el inicio y cierre de sesiÃ³n, asÃ­ como la actualizaciÃ³n de credenciales.\n    \n- Servir como referencia para implementar flujos de seguridad en aplicaciones cliente.\n    \n\n## Casos de uso\n\n- AutenticaciÃ³n de usuarios mediante credenciales.\n    \n- ObtenciÃ³n y validaciÃ³n de tokens de acceso.\n    \n- GestiÃ³n de roles y permisos para controlar el acceso a recursos.\n    \n- ActualizaciÃ³n de contraseÃ±as o datos sensibles de usuario.\n    \n- Consulta de informaciÃ³n de seguridad asociada a un usuario o sesiÃ³n.\n    \n\n## Endpoints incluidos (descripciÃ³n inferida por nombre)\n\nA continuaciÃ³n se listan los endpoints incluidos en esta carpeta, con una breve descripciÃ³n basada en sus nombres:\n\n1. **\\[42161334-dff13095-24e5-4124-ae34-1206b49d197c\\]**\n    \n2. **\\[42161334-2b8deb39-f976-4bcb-bc4b-6244b35eadd8\\]**\n    \n3. **\\[42161334-35a6b04f-8aae-4e49-b399-0d95ab48696a\\]**\n    \n4. **\\[42161334-91005f3f-ed1b-4a41-93d5-61e11bacba8c\\]**\n    \n5. **\\[42161334-41c92d3c-335b-4f40-9383-3ef3d8311b59\\]**\n    \n6. **\\[42161334-66e1a4ac-a6d6-47b1-a03d-61a5bf5d1705\\]**\n    \n7. **\\[42161334-69c101c6-ab7e-415f-a348-cae65124c475\\]**\n    \n8. **\\[42161334-d568ac18-1e8b-46c3-a574-afb4fc7cf8f8\\]**\n    \n9. **\\[42161334-e916464d-1493-48b2-bda6-f3bb028656e9\\]**\n    \n10. **\\[42161334-c590c850-1422-402b-a368-62e7b4a6f2ed\\]**\n    \n11. **\\[42161334-240695c0-5b23-419a-9a93-efcef9bc804a\\]**\n    \n\n> _Nota: Para obtener detalles especÃ­ficos de cada endpoint, consulte la documentaciÃ³n individual de cada solicitud dentro de esta carpeta._ \n  \n\n## GuÃ­a de uso\n\n1. Revise los endpoints disponibles y sus descripciones para identificar el flujo de seguridad requerido.\n    \n2. Utilice los endpoints de autenticaciÃ³n para obtener tokens antes de acceder a recursos protegidos.\n    \n3. Gestione roles y permisos segÃºn las necesidades de su aplicaciÃ³n.\n    \n4. Mantenga las credenciales y tokens de acceso de forma segura.\n    \n\nEsta carpeta es fundamental para garantizar la protecciÃ³n y el control de acceso en la API. Se recomienda mantener actualizada la documentaciÃ³n de cada endpoint y revisar periÃ³dicamente las polÃ­ticas de seguridad implementadas."
		},
		{
			"name": "CICLOS",
			"item": [
				{
					"name": "CP_51 CREAR CICLO CON NOMBRES VACIOS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// =============== Helpers ===============\r",
									"function j() {\r",
									"  try { return pm.response.json(); }\r",
									"  catch(e){ pm.expect.fail(\"La respuesta no es JSON vÃ¡lido\"); }\r",
									"}\r",
									"\r",
									"function expectFieldError(field, expectedMsgContains) {\r",
									"  const body = j();\r",
									"  pm.expect(body).to.have.property('errors');\r",
									"  pm.expect(body.errors).to.have.property(field);\r",
									"  pm.expect(body.errors[field]).to.be.an('array').that.is.not.empty;\r",
									"\r",
									"  const msgs = body.errors[field].map(String).join(\" | \");\r",
									"  pm.expect(msgs.toLowerCase()).to.include(expectedMsgContains.toLowerCase());\r",
									"}\r",
									"\r",
									"// =============== Checks ===============\r",
									"\r",
									"// 1) Status y headers\r",
									"pm.test(\"HTTP 422 Unprocessable Entity\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(422);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type JSON\", () => {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\")).to.match(/application\\/json/i);\r",
									"});\r",
									"\r",
									"// 2) Forma general del error\r",
									"pm.test(\"Estructura estÃ¡ndar de validaciÃ³n\", () => {\r",
									"  const body = j();\r",
									"  pm.expect(body).to.be.an('object');\r",
									"  pm.expect(body).to.have.property('message').that.is.a('string');\r",
									"  pm.expect(body).to.have.property('errors').that.is.an('object');\r",
									"});\r",
									"\r",
									"// 3) Mensaje especÃ­fico para 'name'\r",
									"pm.test(\"Error en 'name' indica que es obligatorio\", () => {\r",
									"  expectFieldError(\"name\", \"El campo name es obligatorio\");\r",
									"});\r",
									"\r",
									"// 4) NO debe venir recurso creado (sin id/data)\r",
									"pm.test(\"No hay entidad creada (sin id / data)\", () => {\r",
									"  const body = j();\r",
									"  // Ajusta estas keys si tu API usa otra convenciÃ³n (e.g. data, id, uuid)\r",
									"  pm.expect(body).to.not.have.property('id');\r",
									"  pm.expect(body).to.not.have.property('data');\r",
									"});\r",
									"\r",
									"// 5) Tiempo de respuesta (opcional)\r",
									"pm.test(\"Tiempo de respuesta razonable (<1500 ms)\", () => {\r",
									"  pm.expect(pm.response.responseTime).to.be.below(1500);\r",
									"});\r",
									"\r",
									"// 6) Schema mÃ­nimo (opcional, mantiene contrato)\r",
									"const schema = {\r",
									"  type: \"object\",\r",
									"  required: [\"message\", \"errors\"],\r",
									"  properties: {\r",
									"    message: { type: \"string\" },\r",
									"    errors: {\r",
									"      type: \"object\",\r",
									"      required: [\"name\"],\r",
									"      properties: {\r",
									"        name: {\r",
									"          type: \"array\",\r",
									"          minItems: 1,\r",
									"          items: { type: \"string\" }\r",
									"        }\r",
									"      },\r",
									"      additionalProperties: true\r",
									"    }\r",
									"  },\r",
									"  additionalProperties: true\r",
									"};\r",
									"\r",
									"pm.test(\"Cumple JSON Schema mÃ­nimo\", function () {\r",
									"  pm.expect(tv4.validate(j(), schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"\",\r\n  \"start_date\": \"2025-01-10\",\r\n  \"end_date\": \"2025-05-20\"\r\n}\r\n\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/activities",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"activities"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_51 CICLOS CREAR CON FECHAS INVALIDAS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// =============== Helpers ===============\r",
									"function j() {\r",
									"  try { return pm.response.json(); }\r",
									"  catch(e){ pm.expect.fail(\"La respuesta no es JSON vÃ¡lido\"); }\r",
									"}\r",
									"\r",
									"function expectFieldError(field, expectedMsgContains) {\r",
									"  const body = j();\r",
									"  pm.expect(body).to.have.property('errors');\r",
									"  pm.expect(body.errors).to.have.property(field);\r",
									"  pm.expect(body.errors[field]).to.be.an('array').that.is.not.empty;\r",
									"\r",
									"  const msgs = body.errors[field].map(String).join(\" | \");\r",
									"  pm.expect(msgs.toLowerCase()).to.include(expectedMsgContains.toLowerCase());\r",
									"}\r",
									"\r",
									"// =============== Checks ===============\r",
									"\r",
									"// 1) Status y headers\r",
									"pm.test(\"HTTP 422 Unprocessable Entity\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(422);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type JSON\", () => {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\")).to.match(/application\\/json/i);\r",
									"});\r",
									"\r",
									"// 2) Forma general del error\r",
									"pm.test(\"Estructura estÃ¡ndar de validaciÃ³n\", () => {\r",
									"  const body = j();\r",
									"  pm.expect(body).to.be.an('object');\r",
									"  pm.expect(body).to.have.property('message').that.is.a('string');\r",
									"  pm.expect(body).to.have.property('errors').that.is.an('object');\r",
									"});\r",
									"\r",
									"// 3) Mensaje especÃ­fico para 'name'\r",
									"pm.test(\"Error en 'name' indica que es obligatorio\", () => {\r",
									"  expectFieldError(\"name\", \"El campo name es obligatorio\");\r",
									"});\r",
									"\r",
									"// 4) NO debe venir recurso creado (sin id/data)\r",
									"pm.test(\"No hay entidad creada (sin id / data)\", () => {\r",
									"  const body = j();\r",
									"  // Ajusta estas keys si tu API usa otra convenciÃ³n (e.g. data, id, uuid)\r",
									"  pm.expect(body).to.not.have.property('id');\r",
									"  pm.expect(body).to.not.have.property('data');\r",
									"});\r",
									"\r",
									"// 5) Tiempo de respuesta (opcional)\r",
									"pm.test(\"Tiempo de respuesta razonable (<1500 ms)\", () => {\r",
									"  pm.expect(pm.response.responseTime).to.be.below(1500);\r",
									"});\r",
									"\r",
									"// 6) Schema mÃ­nimo (opcional, mantiene contrato)\r",
									"const schema = {\r",
									"  type: \"object\",\r",
									"  required: [\"message\", \"errors\"],\r",
									"  properties: {\r",
									"    message: { type: \"string\" },\r",
									"    errors: {\r",
									"      type: \"object\",\r",
									"      required: [\"name\"],\r",
									"      properties: {\r",
									"        name: {\r",
									"          type: \"array\",\r",
									"          minItems: 1,\r",
									"          items: { type: \"string\" }\r",
									"        }\r",
									"      },\r",
									"      additionalProperties: true\r",
									"    }\r",
									"  },\r",
									"  additionalProperties: true\r",
									"};\r",
									"\r",
									"pm.test(\"Cumple JSON Schema mÃ­nimo\", function () {\r",
									"  pm.expect(tv4.validate(j(), schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"packages": {},
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"Ciclo {{$randomInt}}\",\r\n  \"start_date\": \"10-02-2025\",\r\n  \"end_date\": \"2025-02-01\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/activities",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"activities"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_51 CICLOS CREAR CON DATA DUPLICADA",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ============== Helpers =================\r",
									"function j() {\r",
									"  try { return pm.response.json(); }\r",
									"  catch (e) { pm.expect.fail(\"La respuesta no es JSON vÃ¡lido\"); }\r",
									"}\r",
									"const MSG_EXPECTED = \"Ya existe una actividad con ese nombre\";\r",
									"\r",
									"// ============== Checks ==================\r",
									"\r",
									"// 1) Status\r",
									"pm.test(\"HTTP 400 Bad Request\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(400);\r",
									"});\r",
									"\r",
									"// 2) Content-Type\r",
									"pm.test(\"Content-Type es JSON\", () => {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\")).to.match(/application\\/json/i);\r",
									"});\r",
									"\r",
									"// 3) Estructura mÃ­nima\r",
									"pm.test(\"Body tiene estructura de error simple\", () => {\r",
									"  const body = j();\r",
									"  pm.expect(body).to.be.an(\"object\");\r",
									"  pm.expect(body).to.have.property(\"message\").that.is.a(\"string\");\r",
									"});\r",
									"\r",
									"// 4) Mensaje de duplicado\r",
									"pm.test(\"Mensaje indica nombre duplicado\", () => {\r",
									"  const body = j();\r",
									"  pm.expect(body.message.toLowerCase()).to.include(MSG_EXPECTED.toLowerCase());\r",
									"});\r",
									"\r",
									"// 5) No debe existir entidad creada (sin id/data)\r",
									"pm.test(\"No hay recurso creado (sin id/data)\", () => {\r",
									"  const body = j();\r",
									"  pm.expect(body).to.not.have.property(\"id\");\r",
									"  pm.expect(body).to.not.have.property(\"data\");\r",
									"});\r",
									"\r",
									"// 6) SLA de respuesta (opcional)\r",
									"pm.test(\"Tiempo de respuesta < 1500 ms\", () => {\r",
									"  pm.expect(pm.response.responseTime).to.be.below(1500);\r",
									"});\r",
									"\r",
									"// 7) JSON Schema mÃ­nimo (opcional)\r",
									"const schema = {\r",
									"  type: \"object\",\r",
									"  required: [\"message\"],\r",
									"  properties: {\r",
									"    message: { type: \"string\" }\r",
									"  },\r",
									"  additionalProperties: true\r",
									"};\r",
									"pm.test(\"Cumple JSON Schema mÃ­nimo de error\", function () {\r",
									"  pm.expect(tv4.validate(j(), schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"Ciclo I 2025\",\r\n  \"start_date\": \"2025-01-10\",\r\n  \"end_date\": \"2025-05-20\"\r\n}\r\n\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/activities",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"activities"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_51 CREAR CICLO CORRECTO ACTIVO",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {\r",
									"    pm.response.to.have.status(201);\r",
									"});\r",
									"\r",
									"const jsonData = pm.response.json();\r",
									"\r",
									"pm.test(\"El campo 'name' existe y contiene 'Ciclo'\", function () {\r",
									"    pm.expect(jsonData).to.have.property(\"name\");\r",
									"    pm.expect(jsonData.name).to.include(\"Ciclo\");\r",
									"});\r",
									"\r",
									"pm.test(\"La respuesta contiene un id numÃ©rico\", function () {\r",
									"    pm.expect(jsonData).to.have.property(\"id\");\r",
									"    pm.expect(jsonData.id).to.be.a(\"number\");\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"Ciclo II {{$randomInt}}\",\r\n  \"start_date\": \"2025-06-10\",\r\n  \"end_date\": \"2025-11-30\"\r\n}\r\n\r\n\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/activities",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"activities"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_52 LISTADO DE CICLOS ACADEMICOS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ========= Helpers =========\r",
									"function bodyJSON() {\r",
									"  try { return pm.response.json(); }\r",
									"  catch (e) { pm.expect.fail(\"La respuesta no es JSON vÃ¡lido\"); }\r",
									"}\r",
									"const PAGINATE_EXPECTED = 15;   // ajusta si cambias el query\r",
									"\r",
									"// ========= Asserts =========\r",
									"\r",
									"// 1) 200 OK\r",
									"pm.test(\"HTTP 200 OK\", () => {\r",
									"  pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"// 2) Content-Type JSON\r",
									"pm.test(\"Content-Type es JSON\", () => {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\")).to.match(/application\\/json/i);\r",
									"});\r",
									"\r",
									"// 3) Authorization enviado\r",
									"pm.test(\"Se envÃ­a Authorization: Bearer\", () => {\r",
									"  const h = pm.request.headers.get(\"Authorization\") || \"\";\r",
									"  pm.expect(h.startsWith(\"Bearer \")).to.eql(true);\r",
									"});\r",
									"\r",
									"// 4) Estructura de paginaciÃ³n mÃ­nima\r",
									"pm.test(\"Estructura de paginaciÃ³n presente\", () => {\r",
									"  const b = bodyJSON();\r",
									"  pm.expect(b).to.have.property(\"current_page\");\r",
									"  pm.expect(b).to.have.property(\"data\").that.is.an(\"array\");\r",
									"  pm.expect(b).to.have.property(\"last_page\");\r",
									"  pm.expect(b).to.have.property(\"per_page\").that.is.a(\"number\");\r",
									"  pm.expect(b).to.have.property(\"total\");\r",
									"});\r",
									"\r",
									"// 5) Respeta paginate (<= 15)\r",
									"pm.test(\"Cantidad de items <= paginate\", () => {\r",
									"  const b = bodyJSON();\r",
									"  pm.expect(b.data.length).to.be.at.most(PAGINATE_EXPECTED);\r",
									"});\r",
									"\r",
									"// 6) Filtro status=1 aplicado (true/1)\r",
									"pm.test(\"Todos los items tienen status=1/true\", () => {\r",
									"  const b = bodyJSON();\r",
									"  b.data.forEach(it => {\r",
									"    pm.expect([true, 1]).to.include(it.status);\r",
									"  });\r",
									"});\r",
									"\r",
									"// 7) Campos mÃ­nimos por item\r",
									"pm.test(\"Cada ciclo tiene los campos esperados\", () => {\r",
									"  const b = bodyJSON();\r",
									"  b.data.forEach(it => {\r",
									"    pm.expect(it).to.have.property(\"id\").that.is.a(\"number\");\r",
									"    pm.expect(it).to.have.property(\"name\").that.is.a(\"string\").and.not.empty;\r",
									"    pm.expect(it).to.have.property(\"start_date\").that.is.a(\"string\");\r",
									"    pm.expect(it).to.have.property(\"end_date\").that.is.a(\"string\");\r",
									"    pm.expect(it).to.have.property(\"created_at\");\r",
									"    pm.expect(it).to.have.property(\"updated_at\");\r",
									"    pm.expect(it).to.have.property(\"deleted_at\"); // puede ser null\r",
									"  });\r",
									"});\r",
									"\r",
									"// 8) Links/Meta (siempre que vengan)\r",
									"pm.test(\"Links y path coherentes (si existen)\", () => {\r",
									"  const b = bodyJSON();\r",
									"  if (b.path) {\r",
									"    pm.expect(b.first_page_url).to.include(b.path);\r",
									"    pm.expect(b.last_page_url).to.include(b.path);\r",
									"  }\r",
									"});\r",
									"\r",
									"// 9) SLA\r",
									"pm.test(\"Tiempo de respuesta < 1200 ms\", () => {\r",
									"  pm.expect(pm.response.responseTime).to.be.below(1200);\r",
									"});\r",
									"\r",
									"// 10) JSON Schema mÃ­nimo (opcional con tv4)\r",
									"const schema = {\r",
									"  type: \"object\",\r",
									"  required: [\"current_page\", \"data\", \"last_page\", \"per_page\", \"total\"],\r",
									"  properties: {\r",
									"    current_page: { type: \"number\" },\r",
									"    last_page:    { type: \"number\" },\r",
									"    per_page:     { type: \"number\" },\r",
									"    total:        { type: \"number\" },\r",
									"    data: {\r",
									"      type: \"array\",\r",
									"      items: {\r",
									"        type: \"object\",\r",
									"        required: [\"id\",\"name\",\"start_date\",\"end_date\",\"status\"],\r",
									"        properties: {\r",
									"          id: { type: \"number\" },\r",
									"          name: { type: \"string\" },\r",
									"          start_date: { type: \"string\" },\r",
									"          end_date: { type: \"string\" },\r",
									"          status: { anyOf:[{type:\"boolean\"}, {type:\"number\"}] },\r",
									"          created_at: { type: [\"string\",\"null\"] },\r",
									"          updated_at: { type: [\"string\",\"null\"] },\r",
									"          deleted_at: { type: [\"string\",\"null\"] }\r",
									"        },\r",
									"        additionalProperties: true\r",
									"      }\r",
									"    }\r",
									"  },\r",
									"  additionalProperties: true\r",
									"};\r",
									"pm.test(\"Cumple JSON Schema mÃ­nimo\", () => {\r",
									"  pm.expect(tv4.validate(bodyJSON(), schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "\r\n\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/semesters?status=1&paginate=15",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"semesters"
							],
							"query": [
								{
									"key": "status",
									"value": "1"
								},
								{
									"key": "paginate",
									"value": "15"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_53 EDICION DE CICLO ACADEMICO",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ========= Helpers =========",
									"function bodyJSON() {",
									"  try { return pm.response.json(); }",
									"  catch { return null; } // puede ser 204 sin body",
									"}",
									"",
									"// Extrae ID desde la URL (/semesters/:id)",
									"const url = pm.request.url.toString();",
									"const m = url.match(/\\/semesters\\/(\\d+)(?:$|[/?#])/);",
									"const pathId = m ? Number(m[1]) : null;",
									"",
									"// Payload enviado",
									"let sent = {};",
									"try { sent = JSON.parse(pm.request.body?.raw || \"{}\"); } catch { sent = {}; }",
									"",
									"// ========= Asserts base =========",
									"pm.test(\"Auth Bearer presente\", () => {",
									"  const h = pm.request.headers.get(\"Authorization\") || \"\";",
									"  pm.expect(h.startsWith(\"Bearer \")).to.eql(true);",
									"});",
									"",
									"pm.test(\"PUT exitoso (200/202/204)\", () => {",
									"  pm.expect([200,202,204]).to.include(pm.response.code);",
									"});",
									"",
									"pm.test(\"Tiempo de respuesta < 1200 ms\", () => {",
									"  pm.expect(pm.response.responseTime).to.be.below(1200);",
									"});",
									"",
									"// Si NO es 204, validamos cuerpo JSON",
									"if (pm.response.code !== 204) {",
									"  pm.test(\"Content-Type es JSON\", () => {",
									"    pm.response.to.have.header(\"Content-Type\");",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.match(/application\\/json/i);",
									"  });",
									"",
									"  pm.test(\"Estructura mÃ­nima del ciclo actualizado\", () => {",
									"    const j = bodyJSON();",
									"    pm.expect(j).to.be.an(\"object\");",
									"    if (pathId !== null) pm.expect(j).to.have.nested.property(\"semester.id\", pathId);",
									"    pm.expect(j).to.have.nested.property(\"semester.name\").that.is.a(\"string\");",
									"    pm.expect(j).to.have.nested.property(\"semester.start_date\").that.is.a(\"string\");",
									"    pm.expect(j).to.have.nested.property(\"semester.end_date\").that.is.a(\"string\");",
									"    pm.expect(j).to.have.nested.property(\"semester.status\").that.is.a(\"boolean\");",
									"    pm.expect(j).to.have.nested.property(\"semester.created_at\").that.is.a(\"string\");",
									"    pm.expect(j).to.have.nested.property(\"semester.updated_at\").that.is.a(\"string\");",
									"    pm.expect(j).to.have.nested.property(\"semester.deleted_at\");",
									"  });",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"packages": {},
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"CICLO II 2025 Actualizado_3\",\r\n  \"start_date\": \"2025-06-15\",\r\n  \"end_date\": \"2025-11-30\",\r\n  \"status\": true\r\n}\r\n\r\n\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/semesters/2",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"semesters",
								"2"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_55 PERMISOS DE LECTURA EN CICLO ACADEMICO",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"HTTP 200/206 OK\", () => {\r",
									"  pm.expect(pm.response.code, \"El cÃ³digo de estado no es 200 ni 206\").to.be.oneOf([200,206]);\r",
									"});\r",
									"\r",
									"let json = null;\r",
									"try { json = pm.response.json(); } catch(e) {}\r",
									"\r",
									"pm.test(\"JSON vÃ¡lido\", () => {\r",
									"  pm.expect(json, \"La respuesta no es un JSON vÃ¡lido\").to.exist;\r",
									"});\r",
									"\r",
									"pm.test(\"Respuesta contiene 'data'\", () => {\r",
									"  pm.expect(json).to.have.property(\"data\");\r",
									"});\r",
									"\r",
									"const data = Array.isArray(json?.data) ? json.data : (Array.isArray(json) ? json : []);\r",
									"\r",
									"pm.test(\"Lista de ciclos es un array\", () => {\r",
									"  pm.expect(data).to.be.an(\"array\");\r",
									"});\r",
									"\r",
									"if (data.length) {\r",
									"  pm.test(\"Cada ciclo tiene las propiedades esperadas\", () => {\r",
									"    data.forEach(ciclo => {\r",
									"      pm.expect(ciclo).to.have.all.keys(\"name\", \"start_date\", \"end_date\", \"status\");\r",
									"    });\r",
									"  });\r",
									"}\r",
									"\r",
									"pm.test(\"NingÃºn ciclo expone secretos\", () => {\r",
									"  data.forEach(ciclo => {\r",
									"    pm.expect(ciclo).to.not.have.any.keys([\"password\",\"api_token\",\"remember_token\"]);\r",
									"  });\r",
									"});\r",
									"\r",
									"// ValidaciÃ³n de paginaciÃ³n (opcional)\r",
									"pm.test(\"Respuesta contiene paginaciÃ³n\", () => {\r",
									"  pm.expect(json).to.have.all.keys(\"current_page\", \"data\", \"first_page_url\", \"from\", \"last_page\", \"last_page_url\", \"links\", \"next_page_url\", \"path\", \"per_page\", \"prev_page_url\", \"to\", \"total\");\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"CICLO II 2025 Actualizado\",\r\n  \"start_date\": \"2025-06-15\",\r\n  \"end_date\": \"2025-11-30\",\r\n  \"status\": true\r\n}\r\n\r\n\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/semesters?page=1",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"semesters"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_56 PERMISOS DE CREACION DE CICLO ACADEMICO",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"No tiene acceso a la creaciÃ³n (401 o 403)\", function () {\r",
									"    pm.expect([401, 403]).to.include(pm.response.code);\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_secretaria}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"Ciclo III 2026\",\r\n  \"start_date\": \"2026-01-10\",\r\n  \"end_date\": \"2026-07-10\",\r\n  \"status\": true\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/semesters",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"semesters"
							]
						}
					},
					"response": []
				}
			],
			"description": "## ðŸ“ CICLOS\n\nEsta carpeta agrupa los endpoints y pruebas relacionadas con la gestiÃ³n de ciclos acadÃ©micos en el sistema. Incluye pruebas de creaciÃ³n, ediciÃ³n, listado y validaciÃ³n de permisos de acceso para diferentes roles de usuario.\n\n### Endpoints incluidos\n\n- Crear ciclo acadÃ©mico\n    - Casos correctos y de error (nombre vacÃ­o, fechas invÃ¡lidas, duplicados)\n        \n- Listar ciclos acadÃ©micos\n    - Consulta de ciclos activos y paginados\n        \n- Editar ciclo acadÃ©mico\n    - ModificaciÃ³n de datos de un ciclo existente\n        \n- Permisos\n    - Pruebas de acceso para creaciÃ³n y lectura de ciclos segÃºn el rol del usuario\n        \n\n### Requests en la carpeta\n\n1. CP_51 â€“ Ciclos â€“ Crear â€“ Correcto (Estado Activo) Copy  \n    Prueba la creaciÃ³n exitosa de un ciclo acadÃ©mico con datos vÃ¡lidos.\n    \n2. CP_51 â€“ Ciclos â€“ Crear â€“ Nombre vacÃ­o Copy  \n    Prueba la validaciÃ³n de nombre obligatorio al crear un ciclo.\n    \n3. CP_51 â€“ Ciclos â€“ Crear â€“ Fechas invÃ¡lidas Copy  \n    Prueba la validaciÃ³n de fechas incorrectas al crear un ciclo.\n    \n4. CP_51 â€“ Ciclos â€“ Crear â€“ Duplicado Copy  \n    Prueba la validaciÃ³n de duplicidad al crear un ciclo con datos ya existentes.\n    \n5. CP_52 â€“ Listado de ciclos acadÃ©micos Copy  \n    Consulta el listado de ciclos acadÃ©micos activos, con paginaciÃ³n.\n    \n6. CP_53 â€“ EdiciÃ³n de ciclo acadÃ©mico Copy  \n    Prueba la ediciÃ³n de un ciclo acadÃ©mico existente.\n    \n7. CP_55 â€“ Permisos de lectura en ciclos Copy  \n    Valida que solo los usuarios autorizados pueden consultar ciclos.\n    \n8. CP_56 â€“ Permisos de creaciÃ³n de ciclos Copy  \n    Valida que solo los usuarios autorizados pueden crear ciclos.\n    \n\n### Variables utilizadas\n\n- `{{base_url}}`: URL base del entorno.\n    \n- Variables de autenticaciÃ³n y usuario segÃºn el entorno activo.\n    \n\n### Consideraciones\n\n- AsegÃºrate de usar el entorno adecuado para las pruebas (por ejemplo, QA_GESTION_CONTRATOS).\n    \n- Los tests incluidos validan tanto respuestas exitosas como errores esperados por permisos o datos invÃ¡lidos.\n    \n- Puedes agregar mÃ¡s casos de prueba segÃºn los roles y reglas de negocio de tu sistema."
		},
		{
			"name": "ESCUELAS",
			"item": [
				{
					"name": "CP_57 LISTADO DE ESCUELAS POR FACULTAD",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// 1) CÃ³digo de estado 200 OK",
									"pm.test(\"CÃ³digo de estado 200 OK\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"// 2) La respuesta es un array",
									"pm.test(\"La respuesta es un array\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(Array.isArray(jsonData)).to.be.true;",
									"});",
									"",
									"// 3) El array no estÃ¡ vacÃ­o",
									"pm.test(\"El array no estÃ¡ vacÃ­o\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.length).to.be.above(0);",
									"});",
									"",
									"// 4) Cada escuela tiene schoolId, nameSchool y directorName",
									"pm.test(\"Cada escuela tiene schoolId, nameSchool y directorName\", function () {",
									"    var jsonData = pm.response.json();",
									"    jsonData.forEach(function(escuela) {",
									"        pm.expect(escuela).to.have.property(\"schoolId\");",
									"        pm.expect(escuela).to.have.property(\"nameSchool\");",
									"        pm.expect(escuela).to.have.property(\"directorName\");",
									"    });",
									"});",
									"",
									"// 5) schoolId es Ãºnico en la lista",
									"pm.test(\"schoolId es Ãºnico en la lista\", function () {",
									"    var jsonData = pm.response.json();",
									"    var ids = jsonData.map(e => e.schoolId);",
									"    var uniqueIds = new Set(ids);",
									"    pm.expect(uniqueIds.size).to.eql(ids.length);",
									"});",
									"",
									"// 6) El header Content-Type es application/json",
									"pm.test(\"El header Content-Type es application/json\", function () {",
									"    pm.response.to.have.header(\"Content-Type\");",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");",
									"});",
									"",
									"// Script existente para guardar token si existe",
									"const jsonData = pm.response.json();",
									"if (jsonData.access_token) {",
									"    pm.environment.set(\"token\", jsonData.access_token);",
									"    console.log(\"âœ… Token guardado en variable de entorno\");",
									"} else {",
									"    console.log(\"âš ï¸ No se recibiÃ³ token en la respuesta\");",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"Ciclo III 2026\",\r\n  \"start_date\": \"2026-01-10\",\r\n  \"end_date\": \"2026-07-10\",\r\n  \"status\": true\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/faculties/1/schools",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"faculties",
								"1",
								"schools"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_59 EDICION DE ESCUELA",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// 1. CÃ³digo de estado exitoso (200 o 204)",
									"pm.test(\"CÃ³digo de estado exitoso (200 o 204)\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 204]);",
									"});",
									"",
									"// 2. El Content-Type es application/json si hay body",
									"pm.test(\"Content-Type es application/json si hay body\", function () {",
									"    if (pm.response.text().length > 0) {",
									"        pm.response.to.have.header(\"Content-Type\");",
									"        pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");",
									"    }",
									"});",
									"",
									"// 3. La respuesta contiene un objeto School con id, name y faculty_id",
									"pm.test(\"La respuesta contiene un objeto School con id, name y faculty_id\", function () {",
									"    if (pm.response.text().length > 0) {",
									"        var jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.have.property(\"School\");",
									"        pm.expect(jsonData.School).to.have.property(\"id\");",
									"        pm.expect(jsonData.School).to.have.property(\"name\");",
									"        pm.expect(jsonData.School).to.have.property(\"faculty_id\");",
									"    }",
									"});",
									"",
									"// 4. El nombre de la escuela fue actualizado correctamente",
									"pm.test(\"El nombre de la escuela fue actualizado correctamente\", function () {",
									"    if (pm.response.text().length > 0) {",
									"        var jsonData = pm.response.json();",
									"        var expectedName = \"IngenierÃ­a Civil Actualizada Hoy\";",
									"        pm.expect(jsonData.School.name).to.eql(expectedName);",
									"    }",
									"});",
									"",
									"// 5. faculty_id es correcto",
									"pm.test(\"faculty_id es correcto\", function () {",
									"    if (pm.response.text().length > 0) {",
									"        var jsonData = pm.response.json();",
									"        pm.expect(jsonData.School.faculty_id).to.eql(1);",
									"    }",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"IngenierÃ­a Civil Actualizada Hoy\",\r\n  \"faculty_id\": 1,\r\n  \"director_id\": 1\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/schools/2",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"schools",
								"2"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_58 CREACION DE ESCUELA",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Test: Status code is 201 (Created)",
									"pm.test(\"Status code is 201 (Created)\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"// Test: Response body contains a 'school' object",
									"pm.test(\"Response body contains a 'school' object\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('school');",
									"    pm.expect(jsonData.school).to.be.an('object');",
									"});",
									"",
									"// Test: 'school' object has an 'id' property",
									"pm.test(\"'school' object has an 'id' property\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.school).to.have.property('id');",
									"    pm.expect(jsonData.school.id).to.be.a('number');",
									"});",
									"",
									"// Test: 'name' property in response matches the name sent in the request body",
									"pm.test(\"'name' property in response matches the name sent in the request body\", function () {",
									"    var jsonData = pm.response.json();",
									"    var requestBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};",
									"    pm.expect(jsonData.school.name).to.eql(requestBody.name);",
									"});",
									"",
									"// Existing script for variable handling",
									"let responseJson;",
									"try {",
									"    responseJson = pm.response.json();",
									"    console.log(\"Respuesta recibida:\", responseJson);",
									"} catch (e) {",
									"    console.log(\"No se pudo parsear la respuesta como JSON:\", pm.response.text());",
									"    pm.environment.unset(\"escuela_id_creada\");",
									"    return;",
									"}",
									"",
									"let escuelaId = null;",
									"",
									"// Caso 1: Respuesta tiene objeto 'school' con propiedad 'id'",
									"if (responseJson && responseJson.school && responseJson.school.id) {",
									"    escuelaId = responseJson.school.id;",
									"    console.log(\"ID de escuela encontrado en responseJson.school.id:\", escuelaId);",
									"}",
									"// Caso 2: Respuesta tiene propiedad 'id' en la raÃ­z",
									"else if (responseJson && responseJson.id) {",
									"    escuelaId = responseJson.id;",
									"    console.log(\"ID de escuela encontrado en responseJson.id:\", escuelaId);",
									"}",
									"// Caso 3: Buscar id en otras ubicaciones comunes",
									"else if (responseJson && responseJson.data && responseJson.data.id) {",
									"    escuelaId = responseJson.data.id;",
									"    console.log(\"ID de escuela encontrado en responseJson.data.id:\", escuelaId);",
									"}",
									"",
									"if (escuelaId) {",
									"    pm.environment.set(\"escuela_id_creada\", escuelaId);",
									"    console.log(\"âœ… ID de escuela guardado en variable de entorno 'escuela_id_creada':\", escuelaId);",
									"} else {",
									"    pm.environment.unset(\"escuela_id_creada\");",
									"    console.log(\"âš ï¸ No se encontrÃ³ el ID de la escuela en la respuesta. Respuesta completa:\", responseJson);",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"IngenierÃ­a en ComputaciÃ³n\",\r\n  \"director_id\": 1\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/faculties/1/schools",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"faculties",
								"1",
								"schools"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_60 ELIMINAR ESCUELA",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// 1. Verifica el cÃ³digo de estado\r",
									"pm.test(\"Status code is 200 or 204\", function () {\r",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 204]);\r",
									"});\r",
									"\r",
									"// 2. Verifica el mensaje de Ã©xito (ajusta segÃºn el mensaje real de tu API)\r",
									"pm.test(\"Mensaje de Ã©xito en la respuesta\", function () {\r",
									"    var jsonData = {};\r",
									"    try {\r",
									"        jsonData = pm.response.json();\r",
									"    } catch (e) {}\r",
									"    pm.expect(jsonData.message).to.include(\"eliminada\");\r",
									"});\r",
									"\r",
									"// 3. (Opcional) Elimina la variable de entorno si la escuela fue eliminada\r",
									"pm.test(\"Limpia variable escuela_id_creada\", function () {\r",
									"    pm.environment.unset(\"escuela_id_creada\");\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"Ciclo III 2026\",\r\n  \"start_date\": \"2026-01-10\",\r\n  \"end_date\": \"2026-07-10\",\r\n  \"status\": true\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/schools/{{escuela_id_creada}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"schools",
								"{{escuela_id_creada}}"
							]
						}
					},
					"response": []
				}
			],
			"description": "# ðŸ“ **ESCUELAS**\n\nEsta carpeta agrupa todas las solicitudes relacionadas con la gestiÃ³n de escuelas dentro del sistema. Incluye operaciones para listar, crear, editar y eliminar escuelas asociadas a una facultad.\n\n**Solicitudes incluidas:**\n\n- CP_57 â€“ Listado de escuelas por facultad: Permite obtener el listado de escuelas asociadas a una facultad especÃ­fica.\n    \n- CP_58 â€“ CreaciÃ³n de Escuela: Permite crear una nueva escuela dentro de una facultad.\n    \n- CP_59 â€“ EdiciÃ³n de escuela: Permite actualizar la informaciÃ³n de una escuela existente.\n    \n- CP_60 â€“ EliminaciÃ³n de Escuela: Permite eliminar una escuela especÃ­fica del sistema.\n    \n\n**Recomendaciones de uso:**\n\n1. Utiliza la solicitud de listado para obtener las escuelas de una facultad antes de realizar operaciones de ediciÃ³n o eliminaciÃ³n.\n    \n2. Para crear una nueva escuela, utiliza la solicitud de creaciÃ³n proporcionando los datos requeridos.\n    \n3. Para modificar una escuela existente, utiliza la solicitud de ediciÃ³n con el identificador correspondiente.\n    \n4. Para eliminar una escuela, utiliza la solicitud de eliminaciÃ³n con el ID de la escuela a borrar.\n    \n\n**Notas:**\n\n- AsegÃºrate de tener los permisos y el token de autenticaciÃ³n necesarios antes de ejecutar estas solicitudes.\n    \n- Los identificadores de facultad y escuela deben estar correctamente definidos en las variables de entorno o en los parÃ¡metros de la solicitud.\n    \n- Esta carpeta estÃ¡ destinada exclusivamente a la gestiÃ³n de escuelas. No agregues aquÃ­ solicitudes que no correspondan a este propÃ³sito.\n    \n\nEndFragment"
		},
		{
			"name": "ACTIVIDADES",
			"item": [
				{
					"name": "CP_81 LISTAR ACTIVIDADES",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ==================== CP_81 - LISTAR ACTIVIDADES ====================\r",
									"\r",
									"// Helper para validar formato de fecha ISO simple\r",
									"function isISODate(val) {\r",
									"    return typeof val === \"string\" && /\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}/.test(val);\r",
									"}\r",
									"\r",
									"const json = pm.response.json();\r",
									"\r",
									"// --- 1. Estado bÃ¡sico de la respuesta ---\r",
									"\r",
									"pm.test(\"CP_81 - Status code 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"pm.test(\"CP_81 - Content-Type es JSON\", function () {\r",
									"    pm.response.to.have.header(\"Content-Type\");\r",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"pm.test(\"CP_81 - Tiempo de respuesta < 1s\", function () {\r",
									"    pm.expect(pm.response.responseTime).to.be.below(1000);\r",
									"});\r",
									"\r",
									"// --- 2. Estructura de la respuesta ---\r",
									"\r",
									"pm.test(\"CP_81 - La respuesta es un arreglo\", function () {\r",
									"    pm.expect(Array.isArray(json)).to.be.true;\r",
									"});\r",
									"\r",
									"pm.test(\"CP_81 - El arreglo de actividades no viene vacÃ­o\", function () {\r",
									"    pm.expect(json.length).to.be.above(0);\r",
									"});\r",
									"\r",
									"// --- 3. Validaciones por cada actividad ---\r",
									"\r",
									"pm.test(\"CP_81 - Cada actividad tiene los campos obligatorios\", function () {\r",
									"    json.forEach((item, index) => {\r",
									"        pm.expect(item, \"Item \" + index).to.be.an(\"object\");\r",
									"        pm.expect(item).to.have.property(\"id\");\r",
									"        pm.expect(item).to.have.property(\"name\");\r",
									"        pm.expect(item).to.have.property(\"deleted_at\");\r",
									"        pm.expect(item).to.have.property(\"created_at\");\r",
									"        pm.expect(item).to.have.property(\"updated_at\");\r",
									"    });\r",
									"});\r",
									"\r",
									"pm.test(\"CP_81 - Tipos de datos correctos en cada actividad\", function () {\r",
									"    json.forEach((item, index) => {\r",
									"        pm.expect(item.id, \"id en item \" + index).to.be.a(\"number\");\r",
									"        pm.expect(item.name, \"name en item \" + index).to.be.a(\"string\").and.not.empty;\r",
									"        // deleted_at puede ser null o string fecha\r",
									"        pm.expect([\"object\", \"string\"]).to.include(typeof item.deleted_at);\r",
									"        pm.expect(isISODate(item.created_at), \"created_at en item \" + index).to.be.true;\r",
									"        pm.expect(isISODate(item.updated_at), \"updated_at en item \" + index).to.be.true;\r",
									"    });\r",
									"});\r",
									"\r",
									"// --- 4. Calidad de datos ---\r",
									"\r",
									"pm.test(\"CP_81 - IDs de actividades son Ãºnicos\", function () {\r",
									"    const ids = json.map(a => a.id);\r",
									"    const unique = new Set(ids);\r",
									"    pm.expect(unique.size, \"Cantidad de IDs Ãºnicos\").to.eql(ids.length);\r",
									"});\r",
									"\r",
									"// (Opcional) Guardar cantidad de actividades para usar en otros casos de prueba\r",
									"pm.environment.set(\"cp_81_activities_count\", json.length);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/activities",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"activities"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_82 CREAR ACTIVIDAD DUPLICADA",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ========== CP_82 - CREAR ACTIVIDAD DUPLICADA ==========\r",
									"\r",
									"// Intento crear una actividad con un nombre que ya existe\r",
									"\r",
									"let jsonData;\r",
									"\r",
									"pm.test(\"CP_82 - Status code 400 Bad Request\", function () {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									"\r",
									"pm.test(\"CP_82 - Content-Type es JSON\", function () {\r",
									"    pm.response.to.have.header(\"Content-Type\");\r",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"pm.test(\"CP_82 - Tiempo de respuesta < 1s\", function () {\r",
									"    pm.expect(pm.response.responseTime).to.be.below(1000);\r",
									"});\r",
									"\r",
									"\r",
									"pm.test(\"CP_82 - Respuesta es un JSON vÃ¡lido\", function () {\r",
									"    jsonData = pm.response.json();\r",
									"    pm.expect(jsonData).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"pm.test(\"CP_82 - Mensaje de validaciÃ³n por nombre duplicado\", function () {\r",
									"    pm.expect(jsonData).to.have.property(\"message\");\r",
									"    pm.expect(jsonData.message).to.eql(\"Ya existe una actividad con ese nombre\");\r",
									"});\r",
									"\r",
									"\r",
									"pm.test(\"CP_82 - No se devuelve objeto de actividad creado\", function () {\r",
									"    pm.expect(jsonData).to.not.have.property(\"id\");\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_director}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"name\": \"Asesorar el uso de equipo, insumos y materiales diversos\"\r\n}\r\n\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/activities",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"activities"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_83 EDITAR ACTIVIDAD",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Validar que el cÃ³digo de respuesta sea 200",
									"pm.test(\"El cÃ³digo de respuesta es 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"// Validar que el cuerpo contiene el campo 'id' con valor 2",
									"pm.test(\"El campo 'id' es igual a 2\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id', 2);",
									"});",
									"",
									"// Validar que el campo 'name' no estÃ¡ vacÃ­o",
									"pm.test(\"El campo 'name' no estÃ¡ vacÃ­o\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('name');",
									"    pm.expect(jsonData.name).to.be.a('string').and.not.empty;",
									"});",
									"",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_director}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"name\": \"AsesorÃ­a tÃ©cnica en uso de materiales (8 h/sem)\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/activities/2",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"activities",
								"2"
							]
						}
					},
					"response": []
				}
			],
			"description": "## IntroducciÃ³n\nLa carpeta **ACTIVIDADES** agrupa los endpoints relacionados con la gestiÃ³n de actividades en la API. Su propÃ³sito es centralizar las operaciones principales sobre actividades, facilitando su consulta, creaciÃ³n y ediciÃ³n desde un Ãºnico lugar.\n\n## Objetivos principales\n- Listar actividades existentes.\n- Crear nuevas actividades.\n- Editar actividades existentes.\n\n## Casos de uso tÃ­picos\n- Obtener el listado completo de actividades para visualizaciÃ³n o procesamiento.\n- Registrar una nueva actividad en el sistema.\n- Modificar los datos de una actividad previamente creada.\n\n## GuÃ­a de uso general\n1. Selecciona el endpoint adecuado segÃºn la operaciÃ³n que desees realizar (listar, crear o editar).\n2. Consulta la documentaciÃ³n individual de cada solicitud para conocer los parÃ¡metros requeridos y las respuestas esperadas.\n3. Utiliza las variables de entorno (por ejemplo, `{{base_url}}`) para facilitar la configuraciÃ³n y reutilizaciÃ³n de los endpoints.\n\n## Endpoints incluidos\n- **Listar Actividades (API)** [GET]\n- **Crear Actividad Duplicada (API) Copy** [POST]\n- **Listar Actividades (API) Copy** [GET]\n- **Crear Actividad Duplicada** [POST]\n- **Editar Actividad (API) Copy** [PUT]\n- **Editar Actividad (API) Copy** [PUT]\n\n> **Nota:** Consulta la documentaciÃ³n individual de cada solicitud para detalles sobre parÃ¡metros, ejemplos y respuestas especÃ­ficas."
		},
		{
			"name": "FORMATOS",
			"item": [
				{
					"name": "CP_72 CONSULTAR FORMATO POR ID DE CONTRATOS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"CÃ³digo de respuesta es 200\", function () {",
									"    pm.expect(pm.response.code).to.eql(200);",
									"});",
									"",
									"pm.test(\"Respuesta es JSON y contiene la estructura esperada\", function () {",
									"    // Verifica que la respuesta sea JSON",
									"    pm.test(\"La respuesta es JSON\", function () {",
									"        pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
									"    });",
									"    ",
									"    let jsonData;",
									"    try {",
									"        jsonData = pm.response.json();",
									"    } catch (e) {",
									"        pm.expect.fail(\"La respuesta no es un JSON vÃ¡lido\");",
									"    }",
									"    pm.expect(jsonData).to.have.property('format');",
									"    pm.expect(jsonData.format).to.be.an('object');",
									"    pm.expect(jsonData.format).to.have.all.keys(",
									"        'id',",
									"        'name',",
									"        'is_active',",
									"        'file_url',",
									"        'type',",
									"        'type_contract',",
									"        'deleted_at',",
									"        'created_at',",
									"        'updated_at',",
									"        'encoded_file'",
									"    );",
									"    // Validar tipos bÃ¡sicos",
									"    pm.expect(jsonData.format.id).to.be.a('number');",
									"    pm.expect(jsonData.format.name).to.be.a('string');",
									"    pm.expect(jsonData.format.is_active).to.be.a('boolean');",
									"    pm.expect(jsonData.format.file_url).to.be.a('string');",
									"    pm.expect(jsonData.format.type).to.be.a('string');",
									"    pm.expect(jsonData.format.type_contract).to.be.a('string');",
									"    pm.expect(jsonData.format.created_at).to.be.a('string');",
									"    pm.expect(jsonData.format.updated_at).to.be.a('string');",
									"    // Opcionales",
									"    pm.expect(jsonData.format).to.have.property('deleted_at');",
									"    pm.expect(jsonData.format).to.have.property('encoded_file');",
									"    // Validar propiedad document si existe",
									"    if ('document' in jsonData) {",
									"        pm.expect(jsonData.document).to.be.a('string');",
									"    }",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"Escuela de Prueba No Autorizada\",\r\n  \"director_id\": 1\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/formats/1",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"formats",
								"1"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_73 DESCARGAR PLANTILLA DE FORMATOS EN EXCEL",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const jsonData = pm.response.json();",
									"",
									"// Test: CÃ³digo de respuesta 200",
									"pm.test(\"La respuesta tiene cÃ³digo 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"// Test: El cuerpo contiene el campo 'id' con valor 2",
									"pm.test(\"El campo 'id' es igual a 2\", function () {",
									"    pm.expect(jsonData).to.have.property('id', 2);",
									"});",
									"",
									"// Test: El campo 'name' no estÃ¡ vacÃ­o",
									"pm.test(\"El campo 'name' no estÃ¡ vacÃ­o\", function () {",
									"    pm.expect(jsonData).to.have.property('name');",
									"    pm.expect(jsonData.name).to.be.a('string').and.not.empty;",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"Escuela de Prueba No Autorizada\",\r\n  \"director_id\": 1\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/formats/excel/download",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"formats",
								"excel",
								"download"
							]
						}
					},
					"response": []
				}
			],
			"description": "Esta carpeta contiene endpoints relacionados con la gestiÃ³n y descarga de formatos de contratos. Incluye operaciones para descargar plantillas de formatos en Excel y consultar formatos especÃ­ficos por el ID de contrato. Utiliza estos endpoints para obtener plantillas reutilizables y acceder a la informaciÃ³n detallada de los formatos asociados a contratos. Esta documentaciÃ³n facilita a los usuarios la identificaciÃ³n y uso adecuado de los recursos disponibles en esta secciÃ³n."
		},
		{
			"name": "BANCOS",
			"item": [
				{
					"name": "CP_74 â€“ LISTAR BANCOS REGISTRADOS",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (!pm.environment.get(\"token_admin\")) {\r",
									"  throw new Error(\"âš ï¸ Ejecuta primero el Login Admin para obtener el token_admin.\");\r",
									"}\r",
									"pm.environment.set(\"token\", pm.environment.get(\"token_admin\"));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"ðŸ¦ Ejecutando CP_74 â€“ Listar bancos registrados\");\r",
									"\r",
									"pm.test(\"CÃ³digo 200 OK\", () => {\r",
									"    pm.expect(pm.response.code).to.eql(200);\r",
									"});\r",
									"\r",
									"const res = pm.response.json();\r",
									"pm.test(\"Lista de bancos disponible\", () => {\r",
									"    pm.expect(Array.isArray(res.data || res)).to.be.true;\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token_admin}}",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/banks",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"banks"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_75 â€“ CREAR REGISTRO DE BANCO VALIDO",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ======================================================\r",
									"// GENERAR NOMBRE DE BANCO ALEATORIO\r",
									"// ======================================================\r",
									"// Generar un cÃ³digo aleatorio para asegurar unicidad\r",
									"const randomCode = Math.floor(Math.random() * 1000000);\r",
									"pm.variables.set(\"randomCode\", randomCode);\r",
									"pm.variables.set(\"bank_name\", \"Banco_\" + randomCode);\r",
									"console.log(\"Banco generado:\", pm.variables.get(\"bank_name\"));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"Ejecutando CP_75 â€“ Crear registro de banco vÃ¡lido\");",
									"",
									"pm.test(\"CÃ³digo 201 o 200\", () => {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
									"});",
									"",
									"const res = pm.response.json();",
									"pm.environment.set(\"bank_id\", res.id);",
									"console.log(\"âœ… Banco creado con ID:\", res.id);",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token_admin}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"{{bank_name}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/banks",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"banks"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_76 â€“ ACTUALIZAR NOMBRE DE BANCO REGISTRADO",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===============================================",
									"// REUTILIZAR ID DEL BANCO Y GENERAR NUEVO NOMBRE",
									"// ===============================================",
									"let bankId = pm.environment.get(\"bank_id\");",
									"if (!bankId) {",
									"    throw new Error(\"No se encontrÃ³ bank_id en el entorno. Ejecuta CP_75 antes.\");",
									"}",
									"",
									"// Generar un cÃ³digo aleatorio si no existe",
									"let randomCode = pm.variables.get(\"randomCode\") || Math.floor(Math.random() * 1000000).toString();",
									"pm.variables.set(\"randomCode\", randomCode);",
									"",
									"// Generar nombre Ãºnico",
									"let newBankName = \"BancoEdit_\" + randomCode + \"_\" + Date.now();",
									"pm.variables.set(\"new_bank_name\", newBankName);",
									"",
									"// Setear bank_id como variable local para handlebars",
									"pm.variables.set(\"bank_id\", bankId);",
									"",
									"console.log(\"ðŸ”„ Editando banco ID:\", bankId, \"nuevo nombre:\", newBankName);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"CÃ³digo 200 OK\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Nombre de banco actualizado correctamente\", function () {\r",
									"    const jsonData = pm.response.json();\r",
									"    const expectedName = pm.variables.get(\"new_bank_name\");\r",
									"    pm.expect(jsonData).to.have.property(\"name\");\r",
									"    pm.expect(jsonData.name).to.eql(expectedName);\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token_admin}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"{{new_bank_name}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/banks/{{bank_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"banks",
								"{{bank_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_77 â€” ELIMINAR BANCO SIN DEPENDENCIAS",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ============================================================",
									"// Pre-request: CP_77 â€“ Eliminar banco sin dependencias (actualizado)",
									"// - Usa bank_id del entorno si existe (creado/actualizado previamente)",
									"// - Solo crea banco temporal si bank_id no estÃ¡ presente",
									"// - Asegura que la URL use {{bank_id}}",
									"// - Mensajes claros en consola para depuraciÃ³n",
									"// ============================================================",
									"",
									"function fail(msg) { throw new Error(msg); }",
									"",
									"// Asegurar base_url",
									"if (!pm.environment.get(\"base_url\")) {",
									"  pm.environment.set(\"base_url\", \"https://gestioncontratos-production.up.railway.app/api\");",
									"  console.log(\"[CP_77] base_url configurada automÃ¡ticamente\");",
									"}",
									"",
									"// Asegurar token_admin",
									"const tokenAdmin = pm.environment.get(\"token_admin\");",
									"if (!tokenAdmin) fail(\"[CP_77] No se encontrÃ³ {{token_admin}}. Ejecuta primero el Login Admin.\");",
									"pm.environment.set(\"token\", tokenAdmin);",
									"",
									"// Usar bank_id si existe",
									"const bankId = pm.environment.get(\"bank_id\");",
									"if (bankId) {",
									"  pm.environment.set(\"bankId\", bankId); // Para compatibilidad con scripts antiguos",
									"  console.log(`[CP_77] Usando bank_id existente del entorno: ${bankId}`);",
									"  return;",
									"}",
									"",
									"// Si no existe bank_id, crear banco temporal",
									"const tmpName = \"Tmp_Delete_\" + Date.now();",
									"const createReq = {",
									"  url: pm.environment.get(\"base_url\") + \"/banks\",",
									"  method: \"POST\",",
									"  header: {",
									"    \"Authorization\": \"Bearer \" + tokenAdmin,",
									"    \"Content-Type\": \"application/json\",",
									"    \"Accept\": \"application/json\"",
									"  },",
									"  body: {",
									"    mode: \"raw\",",
									"    raw: JSON.stringify({ name: tmpName })",
									"  }",
									"};",
									"",
									"console.log(`[CP_77] No existe bank_id. Creando banco temporal: ${tmpName}`);",
									"pm.sendRequest(createReq, (err, res) => {",
									"  if (err) fail(`[CP_77] âŒ Error creando banco temporal: ${err.message}`);",
									"  if (!res) fail(\"[CP_77] âŒ Sin respuesta al crear banco temporal\");",
									"",
									"  if (![200, 201].includes(res.code)) {",
									"    console.error(\"[CP_77] âš ï¸ Respuesta al crear banco temporal:\", res.code, res.text());",
									"    fail(\"[CP_77] No se pudo crear banco temporal (esperado 200/201).\");",
									"  }",
									"",
									"  let data;",
									"  try { data = res.json(); } catch (e) {",
									"    console.error(\"[CP_77] âš ï¸ Respuesta no JSON al crear banco temporal:\", res.text());",
									"    fail(\"[CP_77] Respuesta no JSON al crear banco temporal.\");",
									"  }",
									"",
									"  if (!data.id) fail(\"[CP_77] âš ï¸ La respuesta al crear banco temporal no contiene 'id'.\");",
									"  pm.environment.set(\"bank_id\", data.id);",
									"  pm.environment.set(\"bankId\", data.id); // Para compatibilidad",
									"  console.log(`[CP_77] Banco temporal creado con id: ${data.id}`);",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"Ejecutando CP_77 â€“ Eliminar banco sin dependencias\");\r",
									"\r",
									"pm.test(\"CÃ³digo 200 o 204\", () => {\r",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 204]);\r",
									"});\r",
									"\r",
									"console.log(\"Banco eliminado correctamente (ID:\", pm.environment.get(\"bank_id\"), \")\");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token_admin}}",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/banks/{{bankId}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"banks",
								"{{bankId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_78 â€“ SIN PERMISOS DE LECTURA EN BANCOS",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ============================================================\r",
									"// Pre-request: CP_78 - Permisos de lectura para rol no administrador\r",
									"// ============================================================\r",
									"\r",
									"if (!pm.environment.get(\"base_url\")) {\r",
									"  pm.environment.set(\"base_url\", \"https://gestioncontratos-production.up.railway.app/api\");\r",
									"  console.log(\"ðŸŒ base_url configurada automÃ¡ticamente\");\r",
									"}\r",
									"\r",
									"// Selecciona un token de usuario SIN permisos de bancos\r",
									"let token = pm.environment.get(\"token_rrhh\") || pm.environment.get(\"token_candidato\") || pm.environment.get(\"token_director\");\r",
									"\r",
									"if (!token) {\r",
									"  throw new Error(\"âš ï¸ No se encontrÃ³ token de un rol sin permisos (usa token_rrhh, token_candidato o token_director). Ejecuta primero el login correspondiente.\");\r",
									"}\r",
									"\r",
									"pm.environment.set(\"token\", token);\r",
									"console.log(\"ðŸ‘¤ Token de rol sin permisos configurado correctamente\");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"Ejecutando CP_78 â€“ Permisos de lectura restringidos\");",
									"",
									"pm.test(\"CÃ³digo 401 o 403\", () => {",
									"    pm.expect(pm.response.code).to.be.oneOf([401, 403]);",
									"});",
									"",
									"const bodyText = pm.response.text().toLowerCase();",
									"pm.test(\"Mensaje indica restricciÃ³n\", () => {",
									"    pm.expect(bodyText).to.match(/forbidden|unauthorized|unauthenticated|access denied|permission/);",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_secretaria}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "{{token_rrhh}}",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/banks",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"banks"
							]
						}
					},
					"response": []
				}
			],
			"description": "Este folder contiene el flujo recomendado para pruebas sobre el recurso de bancos. El flujo sugerido es:\n\n1. **Crear banco (CP_75 â€“ Crear registro de banco vÃ¡lido):** Se recomienda crear un banco utilizando un nombre generado de forma Ãºnica en cada iteraciÃ³n para evitar duplicados.\n2. **Actualizar banco (CP_76 â€“ Actualizar nombre de banco registrado):** Utiliza el mismo `bank_id` obtenido tras la creaciÃ³n para modificar el nombre del banco. El nuevo nombre tambiÃ©n debe ser Ãºnico.\n3. **Eliminar banco (CP_77 â€” Eliminar banco sin dependencias):** Finalmente, elimina el banco usando el mismo `bank_id`.\n\nEste flujo garantiza que cada ciclo de pruebas sea independiente y no genere conflictos por nombres repetidos.\n\nAdicionalmente:\n- **CP_74 â€“ Listar bancos registrados:** Permite consultar todos los bancos existentes.\n- **CP_78 â€“ Permisos de lectura para rol diferente a administrador en Bancos:** Permite verificar los permisos de acceso a la consulta de bancos segÃºn el rol del usuario.\n\nSigue este orden para asegurar la correcta validaciÃ³n de la API y la limpieza de datos tras cada prueba."
		},
		{
			"name": "FACULTADES",
			"item": [
				{
					"name": "CP_84  CREAR FACULTAD CON USUARIO CON PERMISOS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"Ejecutando CP_84 â€“ Crear facultad\");",
									"",
									"pm.test(\"CÃ³digo 201 o 200\", () => {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
									"});",
									"",
									"const res = pm.response.json();",
									"",
									"// Guardar correctamente el id de la facultad creada",
									"if (res && res.faculty && res.faculty.id) {",
									"    pm.environment.set(\"faculty_id\", res.faculty.id);",
									"    console.log(\"âœ… Facultad creada con ID:\", res.faculty.id);",
									"} else if (res && res.id) {",
									"    pm.environment.set(\"faculty_id\", res.id);",
									"    console.log(\"ID de facultad creada guardado en variable de entorno:\", res.id);",
									"}",
									"",
									"// 1. Validar que la respuesta tenga la propiedad 'faculty'.",
									"pm.test(\"La respuesta tiene la propiedad 'faculty'\", function () {",
									"    pm.expect(res).to.have.property('faculty');",
									"});",
									"",
									"// 2. Verificar que el nombre de la facultad creada sea igual al valor de la variable 'faculty_name'.",
									"pm.test(\"El nombre de la facultad creada es igual a la variable 'faculty_name'\", function () {",
									"    pm.expect(res.faculty.name).to.eql(pm.variables.get('faculty_name'));",
									"});",
									"",
									"// 3. Comprobar que el campo 'id' exista y sea un nÃºmero.",
									"pm.test(\"El campo 'id' existe y es un nÃºmero\", function () {",
									"    pm.expect(res.faculty).to.have.property('id');",
									"    pm.expect(res.faculty.id).to.be.a('number');",
									"});",
									"",
									"// 4. Verificar que los campos 'created_at' y 'updated_at' existan y sean fechas vÃ¡lidas.",
									"pm.test(\"'created_at' y 'updated_at' existen y son fechas vÃ¡lidas\", function () {",
									"    pm.expect(res.faculty).to.have.property('created_at');",
									"    pm.expect(res.faculty).to.have.property('updated_at');",
									"    const createdAt = Date.parse(res.faculty.created_at);",
									"    const updatedAt = Date.parse(res.faculty.updated_at);",
									"    pm.expect(isNaN(createdAt)).to.eql(false);",
									"    pm.expect(isNaN(updatedAt)).to.eql(false);",
									"});",
									"",
									"// 5. Validar que el nombre no sea 'Facultad_undefined'.",
									"pm.test(\"El nombre de la facultad no es 'Facultad_undefined'\", function () {",
									"    pm.expect(res.faculty.name).to.not.eql('Facultad_undefined');",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ======================================================",
									"// GENERAR NOMBRE DE FACULTAD ALEATORIO",
									"// ======================================================",
									"// Si no existe randomCode, generarlo",
									"if (!pm.variables.get(\"randomCode\")) {",
									"    // Genera un cÃ³digo aleatorio de 6 caracteres alfanumÃ©ricos",
									"    const randomCode = Math.random().toString(36).substring(2, 8).toUpperCase();",
									"    pm.variables.set(\"randomCode\", randomCode);",
									"}",
									"",
									"const randomCodeValue = pm.variables.get(\"randomCode\");",
									"const facultyName = randomCodeValue ? \"Facultad_\" + randomCodeValue : \"Facultad_\" + Date.now();",
									"pm.variables.set(\"faculty_name\", facultyName);",
									"console.log(\"Facultad generada:\", pm.variables.get(\"faculty_name\"));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token_admin}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"{{faculty_name}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/faculties",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"faculties"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_86 EDITAR FACULTAD CON PERMISOS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"ðŸ« Ejecutando CP_86 â€“ Editar facultad\");",
									"",
									"pm.test(\"CÃ³digo 200 OK\", () => {",
									"    pm.expect(pm.response.code).to.eql(200);",
									"});",
									"",
									"const res = pm.response.json();",
									"",
									"pm.test(\"La respuesta tiene la propiedad 'faculty'\", () => {",
									"    pm.expect(res).to.have.property('faculty');",
									"});",
									"",
									"pm.test(\"El nombre editado es igual a 'faculty_name_edit'\", () => {",
									"    pm.expect(res.faculty.name).to.eql(pm.variables.get('faculty_name_edit'));",
									"});",
									"",
									"pm.test(\"El id de la facultad existe y es un nÃºmero\", () => {",
									"    pm.expect(res.faculty).to.have.property('id');",
									"    pm.expect(res.faculty.id).to.be.a('number');",
									"});",
									"",
									"function isValidDate(dateString) {",
									"    return !isNaN(Date.parse(dateString));",
									"}",
									"",
									"pm.test(\"'created_at' y 'updated_at' existen y son fechas vÃ¡lidas\", () => {",
									"    pm.expect(res.faculty).to.have.property('created_at');",
									"    pm.expect(res.faculty).to.have.property('updated_at');",
									"    pm.expect(isValidDate(res.faculty.created_at)).to.be.true;",
									"    pm.expect(isValidDate(res.faculty.updated_at)).to.be.true;",
									"});",
									"",
									"pm.test(\"El nombre no contiene 'undefined'\", () => {",
									"    pm.expect(res.faculty.name).to.not.include('undefined');",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ======================================================",
									"// REUTILIZAR ID DE FACULTAD CREADA Y NUEVO NOMBRE",
									"// ASEGURAR QUE 'randomCode' ESTÃ‰ DEFINIDO",
									"// ======================================================",
									"let facultyId = pm.environment.get(\"faculty_id\") || 1;",
									"pm.variables.set(\"faculty_id\", facultyId);",
									"",
									"let randomCode = pm.variables.get(\"randomCode\");",
									"if (!randomCode) {",
									"    // Generar un string aleatorio de 6 caracteres alfanumÃ©ricos",
									"    randomCode = Math.random().toString(36).substring(2, 8);",
									"    pm.variables.set(\"randomCode\", randomCode);",
									"}",
									"pm.variables.set(\"faculty_name_edit\", \"FacultadEdit_\" + randomCode);",
									"",
									"console.log(\"âœï¸ Editando facultad ID:\", facultyId, \"nuevo nombre:\", pm.variables.get(\"faculty_name_edit\"));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token_admin}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"{{faculty_name_edit}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/faculties/{{faculty_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"faculties",
								"{{faculty_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_85 ELIMINAR FACULTAD SIN PERMISOS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"Ejecutando CP_85 â€“ Eliminar facultad sin permisos (acceso no autorizado)\");\r",
									"\r",
									"pm.test(\"Debe responder 401 o 403 (acceso no autorizado)\", () => {\r",
									"    pm.expect(pm.response.code).to.be.oneOf([401, 403]);\r",
									"});\r",
									"\r",
									"console.log(\"âŒ Acceso no autorizado correctamente validado\");"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_rrhh}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token_admin}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/faculties/{{faculty_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"faculties",
								"{{faculty_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_85.1 ELIMINAR FACULTAD SIN DEPENDENCIAS",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"Ejecutando tests para ediciÃ³n de Facultad (CP_85.1)\");",
									"",
									"// 1. Verificar cÃ³digo de respuesta",
									"pm.test(\"CÃ³digo de respuesta es 200 o 204\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 204]);",
									"});",
									"",
									"// 2. Si hay body, validar que name sea igual a {{faculty_name_edit}}",
									"if (pm.response.code === 200 && pm.response.text().trim().length > 0) {",
									"    let jsonData;",
									"    try {",
									"        jsonData = pm.response.json();",
									"    } catch (e) {",
									"        console.error(\"La respuesta no es JSON vÃ¡lido\");",
									"        pm.test(\"Respuesta es JSON vÃ¡lido\", function () {",
									"            pm.expect.fail(\"La respuesta no es JSON vÃ¡lido\");",
									"        });",
									"    }",
									"    if (jsonData) {",
									"        const expectedName = pm.environment.get(\"faculty_name_edit\");",
									"        pm.test(\"El campo 'name' es igual a {{faculty_name_edit}}\", function () {",
									"            pm.expect(jsonData.name).to.eql(expectedName);",
									"        });",
									"        if (jsonData.id) {",
									"            pm.environment.set(\"faculty_id\", jsonData.id);",
									"            console.log(`ID de facultad editada guardado en variable de entorno: ${jsonData.id}`);",
									"        } else {",
									"            console.warn(\"No se encontrÃ³ el campo 'id' en la respuesta para guardar en faculty_id\");",
									"        }",
									"        console.log(`Facultad editada correctamente. Nombre: ${jsonData.name}`);",
									"    }",
									"} else {",
									"    console.log(\"No hay body en la respuesta o el cÃ³digo no es 200. Solo se valida el cÃ³digo de estado.\");",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token_admin}}",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/faculties/{{faculty_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"faculties",
								"{{faculty_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_87 LISTAR FACULTADES",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"ðŸ“‹ Ejecutando CP_87 â€“ Listar facultades\");\r",
									"\r",
									"pm.test(\"CÃ³digo 200 OK\", () => {\r",
									"    pm.expect(pm.response.code).to.eql(200);\r",
									"});\r",
									"\r",
									"const res = pm.response.json();\r",
									"pm.test(\"Se obtiene lista de facultades\", () => {\r",
									"    pm.expect(Array.isArray(res.data || res)).to.be.true;\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token_admin}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/faculties",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"faculties"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_88 CREAR FACULTAD DUPLICADA",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"Ejecutando CP_88 â€“ Crear facultad duplicada\");\r",
									"\r",
									"pm.test(\"CÃ³digo de respuesta 422\", () => {\r",
									"    pm.expect(pm.response.code).to.eql(422);\r",
									"});\r",
									"\r",
									"pm.test(\"Mensaje de error por duplicidad\", () => {\r",
									"    const msg = pm.response.json().message || \"\";\r",
									"    pm.expect(msg.toLowerCase()).to.include(\"ya existe\");\r",
									"});\r",
									"\r",
									"// Validar que la respuesta sea JSON\r",
									"pm.test(\"La respuesta es JSON\", () => {\r",
									"    pm.response.to.have.header(\"Content-Type\", /application\\/json/);\r",
									"});\r",
									"\r",
									"// Validar que no se haya creado una nueva facultad\r",
									"pm.test(\"No se devuelve objeto faculty\", () => {\r",
									"    const res = pm.response.json();\r",
									"    pm.expect(res).to.not.have.property('faculty');\r",
									"});\r",
									"\r",
									"// (Opcional) Validar estructura de errores si existe\r",
									"pm.test(\"La respuesta tiene detalles de error\", () => {\r",
									"    const res = pm.response.json();\r",
									"    pm.expect(res).to.have.property('message');\r",
									"    // Si hay un campo errors, puedes validar su contenido\r",
									"    // pm.expect(res).to.have.property('errors');\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token_admin}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"name\": \"Facultad de Ciencias\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/faculties",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"faculties"
							]
						}
					},
					"response": []
				}
			],
			"description": "# ðŸ“FACULTADES\n\n**PropÃ³sito:**  \nEste folder agrupa todos los endpoints relacionados con la gestiÃ³n de facultades dentro de la API de gestiÃ³n de contratos. Permite realizar operaciones CRUD (crear, listar, actualizar y eliminar) sobre las facultades, facilitando la administraciÃ³n de estas entidades clave en el sistema.\n\n**Endpoints incluidos:**\n\n- Crear facultad (Facultad Correcta y Facultad Duplicada)\n    \n- Listar facultades\n    \n- Actualizar facultad\n    \n- Eliminar facultad (Con Permisos y sin Dependencia, Sin permisos).\n    \n\n**Uso en el contexto de la API:**  \nLas operaciones aquÃ­ documentadas son esenciales para mantener actualizada la informaciÃ³n de las facultades, que pueden ser requeridas en otros procesos del sistema, como la gestiÃ³n de escuelas, contratos o solicitudes de contrataciÃ³n. El identificador de facultad (`faculty_id`) generado al crear una nueva facultad puede ser reutilizado en pruebas posteriores o en otros endpoints que lo requieran como referencia.\n\n**Buenas prÃ¡cticas:**\n\n- Utiliza los endpoints en el orden lÃ³gico (crear antes de actualizar/eliminar).\n    \n- Guarda el `faculty_id` generado para reutilizarlo en otros flujos.\n    \n- Consulta la documentaciÃ³n de cada request para detalles de parÃ¡metros y ejemplos de uso.\n    \n\nEste folder es el punto de partida para cualquier operaciÃ³n relacionada con facultades en la API de gestiÃ³n de contratos.",
			"auth": {
				"type": "noauth"
			},
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "CARGOS",
			"item": [
				{
					"name": "CP_62 LISTAR CARGOS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 200 al listar cargos\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"const json = pm.response.json();",
									"// Ajusta si tu API envuelve en data, e.g. json.data",
									"const lista = json.data || json;",
									"",
									"pm.test(\"Hay al menos un cargo en el listado\", function () {",
									"    pm.expect(lista.length).to.be.above(0);",
									"});",
									"",
									"// Guardar el primer cargo como referencia",
									"const cargo = lista[0];",
									"pm.environment.set(\"cargo_id\", cargo.id);",
									"pm.environment.set(\"cargo_nombre\", cargo.name || cargo.nombre);",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/positions",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"positions"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_62 VER DETALLES DE CARGO",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 200 al ver detalle de cargo\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"const detalle = pm.response.json();",
									"const data = detalle.data || detalle;",
									"",
									"pm.test(\"El nombre del cargo coincide con el listado\", function () {",
									"    const esperado = pm.environment.get(\"cargo_nombre\");",
									"    pm.expect(data.name || data.nombre).to.eql(esperado);",
									"});",
									"",
									"pm.test(\"El detalle incluye actividades asociadas\", function () {",
									"    const actividades = data.activities || data.actividades;",
									"    pm.expect(actividades).to.be.an(\"array\");",
									"    // Si esperas al menos 1 actividad:",
									"    pm.expect(actividades.length).to.be.above(0);",
									"});",
									"",
									"pm.test(\"Las actividades no tienen datos nulos\", function () {",
									"    const actividades = data.activities || data.actividades || [];",
									"    actividades.forEach(a => {",
									"        pm.expect(a.id, \"ID de actividad no debe ser nulo\").to.exist;",
									"        pm.expect(a.name || a.nombre, \"Nombre de actividad no debe ser nulo\").to.exist;",
									"    });",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/positions/{{cargo_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"positions",
								"{{cargo_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_63 LISTAR CARGOS SIN PERMISOS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Esperamos 401 o 403, segÃºn cÃ³mo estÃ© tu API",
									"pm.test(\"Acceso denegado al mÃ³dulo Cargos para rol sin permisos\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([401, 403]);",
									"});",
									"",
									"// Si tu API devuelve un mensaje, lo puedes validar tambiÃ©n:",
									"const json = pm.response.json();",
									"if (json.message) {",
									"    pm.test(\"Mensaje de error descriptivo\", function () {",
									"        pm.expect(json.message.toLowerCase()).to.include(\"unauthorized\")",
									"          .or.to.include(\"forbidden\")",
									"          .or.to.include(\"no tiene permisos\");",
									"    });",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_secretaria}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/positions",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"positions"
							]
						}
					},
					"response": []
				}
			],
			"description": "# CARGOS\n\nCarpeta de pruebas de calidad para la gestiÃ³n de Cargos en el sistema. Esta carpeta contiene casos de prueba organizados para validar las operaciones relacionadas con la administraciÃ³n de cargos o posiciones:\n\n**Subcarpetas incluidas:**\n\n- **CP_62**: Casos de prueba para listar cargos - Incluye la solicitud GET para obtener el listado de todos los cargos/posiciones registrados en el sistema\n    \n- **CP_63**: Casos de prueba adicionales para operaciones de cargos\n    \n\n**Solicitud principal:**\n\n- **CP_62 Listar cargos**: Consulta GET a {{base_url}}/positions para obtener todos los cargos disponibles\n    \n\n**PropÃ³sito:**  \nEstos casos de prueba estÃ¡n diseÃ±ados para asegurar el correcto funcionamiento del mÃ³dulo de gestiÃ³n de cargos, validando la consulta y administraciÃ³n de posiciones en el Sistema de GestiÃ³n de Contratos. Los cargos son fundamentales para la asignaciÃ³n de roles y responsabilidades dentro del sistema."
		},
		{
			"name": "BITACORA",
			"item": [
				{
					"name": "CP_19 LISTAR BITACORAS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// 1. Status 200 al listar bitÃ¡cora",
									"pm.test(\"Status 200 al listar bitÃ¡cora\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"// 2. Se listan acciones en bitÃ¡cora",
									"pm.test(\"Se listan acciones en bitÃ¡cora\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('worklog');",
									"    pm.expect(jsonData.worklog).to.have.property('data');",
									"    pm.expect(jsonData.worklog.data).to.be.an('array');",
									"    pm.expect(jsonData.worklog.data.length).to.be.greaterThan(0);",
									"});",
									"",
									"// 3. Cada registro tiene usuario, acciÃ³n, relevancia y fecha",
									"pm.test(\"Cada registro tiene usuario, acciÃ³n, relevancia y fecha\", function () {",
									"    const jsonData = pm.response.json();",
									"    const records = jsonData.worklog.data;",
									"    ",
									"    records.forEach(function(record) {",
									"        pm.expect(record).to.have.property('username');",
									"        pm.expect(record.username).to.be.a('string');",
									"        ",
									"        pm.expect(record).to.have.property('actionLog');",
									"        pm.expect(record.actionLog).to.be.a('string');",
									"        ",
									"        pm.expect(record).to.have.property('relevance');",
									"        pm.expect(record.relevance).to.be.a('string');",
									"        ",
									"        pm.expect(record).to.have.property('created_at');",
									"        pm.expect(record.created_at).to.be.a('string');",
									"    });",
									"});",
									"",
									"// 4. La respuesta incluye informaciÃ³n de paginaciÃ³n",
									"pm.test(\"La respuesta incluye informaciÃ³n de paginaciÃ³n\", function () {",
									"    const jsonData = pm.response.json();",
									"    const worklog = jsonData.worklog;",
									"    ",
									"    pm.expect(worklog).to.have.property('current_page');",
									"    pm.expect(worklog.current_page).to.be.a('number');",
									"    ",
									"    pm.expect(worklog).to.have.property('last_page');",
									"    pm.expect(worklog.last_page).to.be.a('number');",
									"    ",
									"    pm.expect(worklog).to.have.property('per_page');",
									"    pm.expect(worklog.per_page).to.be.a('number');",
									"    ",
									"    pm.expect(worklog).to.have.property('total');",
									"    pm.expect(worklog.total).to.be.a('number');",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token_super}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/worklog",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"worklog"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_20 FILTRAR POR RELEVANCIA",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 200 al filtrar por relevancia\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"const json = pm.response.json();",
									"const worklog = json.worklog || {};",
									"const data = Array.isArray(worklog.data) ? worklog.data : [];",
									"const filtroRel = (pm.environment.get(\"filtro_relevancia\") || \"baja\").toLowerCase();",
									"",
									"if (data.length > 0) {",
									"    pm.test(\"Todos los registros tienen la relevancia filtrada\", function () {",
									"        data.forEach(log => {",
									"            const rel = (log.relevance || log.prioridad || \"\").toLowerCase();",
									"            pm.expect(rel).to.eql(filtroRel);",
									"        });",
									"    });",
									"} else {",
									"    pm.test('Sin datos: se muestra mensaje \"No hay datos\"', function () {",
									"        // Busca el mensaje en posibles ubicaciones",
									"        const msg = (worklog.message || worklog.msg || json.message || json.msg || \"\").toLowerCase();",
									"        pm.expect(msg).to.include(\"no hay datos\");",
									"    });",
									"}"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token_super}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/worklog?relevance={{filtro_relevancia}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"worklog"
							],
							"query": [
								{
									"key": "relevance",
									"value": "{{filtro_relevancia}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_20 FILTRAR LISTADO DE BITACORA",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Test: Status code 200",
									"pm.test(\"Status 200 al filtrar por fecha\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"// Test: Respuesta es JSON vÃ¡lida",
									"let json;",
									"pm.test(\"Respuesta es JSON vÃ¡lida\", function () {",
									"    json = pm.response.json();",
									"    pm.expect(json).to.be.an(\"object\");",
									"});",
									"",
									"// Test: Estructura esperada",
									"pm.test(\"La respuesta tiene la propiedad 'worklog' y 'data' es un arreglo\", function () {",
									"    pm.expect(json).to.have.property(\"worklog\");",
									"    pm.expect(json.worklog).to.be.an(\"object\");",
									"    pm.expect(json.worklog).to.have.property(\"data\");",
									"    pm.expect(json.worklog.data).to.be.an(\"array\");",
									"});",
									"",
									"const data = json.worklog.data;",
									"",
									"if (Array.isArray(data) && data.length > 0) {",
									"    // Tomar la fecha del primer registro (YYYY-MM-DD)",
									"    const primerRegistro = data[0];",
									"    const fechaPrimerRegistro = (primerRegistro.created_at || primerRegistro.fecha || \"\").substring(0, 10);",
									"    ",
									"    // Actualizar variable de entorno 'filtro_fecha' si es diferente",
									"    const filtroFechaActual = pm.environment.get(\"filtro_fecha\");",
									"    if (filtroFechaActual !== fechaPrimerRegistro) {",
									"        pm.environment.set(\"filtro_fecha\", fechaPrimerRegistro);",
									"        pm.test(`Se ajustÃ³ la variable 'filtro_fecha' a la fecha del primer registro: ${fechaPrimerRegistro}`, function () {",
									"            pm.expect(pm.environment.get(\"filtro_fecha\")).to.eql(fechaPrimerRegistro);",
									"        });",
									"    } else {",
									"        pm.test(`La variable 'filtro_fecha' ya coincide con la fecha del primer registro: ${fechaPrimerRegistro}` , function () {",
									"            pm.expect(pm.environment.get(\"filtro_fecha\")).to.eql(fechaPrimerRegistro);",
									"        });",
									"    }",
									"",
									"    // Validar que todos los registros tengan la misma fecha",
									"    pm.test(`Todos los registros corresponden a la fecha: ${fechaPrimerRegistro}`, function () {",
									"        let inconsistencias = [];",
									"        data.forEach(log => {",
									"            const fecha = (log.created_at || log.fecha || \"\").substring(0, 10);",
									"            if (fecha !== fechaPrimerRegistro) {",
									"                inconsistencias.push({id: log.id, fecha});",
									"            }",
									"        });",
									"        pm.expect(inconsistencias, `Registros con fechas distintas: ${JSON.stringify(inconsistencias)}`).to.be.empty;",
									"    });",
									"} else {",
									"    pm.test('Sin datos: se muestra mensaje \"No hay datos\"', function () {",
									"        const msg = (json.message || json.msg || \"\").toLowerCase();",
									"        pm.expect(msg).to.include(\"no hay datos\");",
									"    });",
									"}"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token_super}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/worklog?date={{filtro_fecha}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"worklog"
							],
							"query": [
								{
									"key": "date",
									"value": "{{filtro_fecha}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_21 LISTAR PAGINA SIGUIENTE BITACORA",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 200 en pÃ¡gina siguiente\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"let json;",
									"try {",
									"    json = pm.response.json();",
									"    pm.test(\"La respuesta es un JSON vÃ¡lido\", function () {",
									"        pm.expect(json).to.be.an(\"object\");",
									"    });",
									"} catch (e) {",
									"    pm.test(\"La respuesta no es un JSON vÃ¡lido\", function () {",
									"        pm.expect.fail(\"La respuesta no es un JSON vÃ¡lido\");",
									"    });",
									"}",
									"",
									"// Validar estructura principal",
									"pm.test(\"La respuesta contiene la propiedad 'worklog'\", function () {",
									"    pm.expect(json).to.have.property(\"worklog\");",
									"});",
									"",
									"const worklog = json.worklog;",
									"pm.test(\"'worklog' es un objeto y contiene las propiedades esperadas\", function () {",
									"    pm.expect(worklog).to.be.an(\"object\");",
									"    pm.expect(worklog).to.have.property(\"data\").that.is.an(\"array\");",
									"    pm.expect(worklog).to.have.property(\"current_page\").that.is.a(\"number\");",
									"    pm.expect(worklog).to.have.property(\"last_page\").that.is.a(\"number\");",
									"    pm.expect(worklog).to.have.property(\"per_page\").that.is.a(\"number\");",
									"    pm.expect(worklog).to.have.property(\"total\").that.is.a(\"number\");",
									"});",
									"",
									"// Validar registros si hay mÃ¡s pÃ¡ginas",
									"pm.test(\"Se recibieron registros en la pÃ¡gina siguiente si corresponde\", function () {",
									"    const tieneMas = pm.environment.get(\"tiene_mas_paginas\");",
									"    const registros = Array.isArray(worklog.data) ? worklog.data : [];",
									"    if (tieneMas === true || tieneMas === \"true\") {",
									"        pm.expect(registros.length).to.be.above(0);",
									"    } else {",
									"        pm.expect(true).to.be.true; // No aplica si solo hay una pÃ¡gina",
									"    }",
									"});",
									"",
									"// Validar estructura de los registros",
									"pm.test(\"Cada registro tiene la estructura esperada\", function () {",
									"    const registros = Array.isArray(worklog.data) ? worklog.data : [];",
									"    registros.forEach(function (item) {",
									"        pm.expect(item).to.be.an(\"object\");",
									"        pm.expect(item).to.have.property(\"id\").that.is.a(\"number\");",
									"        pm.expect(item).to.have.property(\"username\").that.is.a(\"string\");",
									"        pm.expect(item).to.have.property(\"actionLog\").that.is.a(\"string\");",
									"        pm.expect(item).to.have.property(\"relevance\").that.is.a(\"string\");",
									"        pm.expect(item).to.have.property(\"created_at\").that.is.a(\"string\");",
									"        pm.expect(item).to.have.property(\"updated_at\").that.is.a(\"string\");",
									"    });",
									"});",
									"",
									"// Validar que current_page y last_page sean consistentes",
									"pm.test(\"current_page y last_page son consistentes\", function () {",
									"    pm.expect(worklog.current_page).to.be.at.least(1);",
									"    pm.expect(worklog.last_page).to.be.at.least(worklog.current_page);",
									"});",
									"",
									"// Validar que per_page sea igual al parÃ¡metro enviado",
									"pm.test(\"per_page coincide con el parÃ¡metro enviado\", function () {",
									"    pm.expect(worklog.per_page).to.eql(20);",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token_super}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/worklog?page=1&per_page=20",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"worklog"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "per_page",
									"value": "20"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_21 PAGINACION DE LISTADO BITACORA",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 200 pÃ¡gina 1 bitÃ¡cora\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"const json = pm.response.json();",
									"const worklog = json.worklog || {};",
									"const data = Array.isArray(worklog.data) ? worklog.data : [];",
									"const meta = worklog;",
									"const perPage = typeof worklog.per_page === 'number' ? worklog.per_page : 15;",
									"",
									"pm.test(\"Se recibieron registros en pÃ¡gina 1\", function () {",
									"    pm.expect(data.length).to.be.above(0);",
									"});",
									"",
									"pm.test(\"No se excede el tamaÃ±o de pÃ¡gina\", function () {",
									"    pm.expect(data.length).to.be.at.most(perPage);",
									"});",
									"",
									"// Guardamos info para la siguiente pÃ¡gina",
									"if (meta.current_page && meta.last_page && meta.current_page < meta.last_page) {",
									"    pm.environment.set(\"tiene_mas_paginas\", true);",
									"    pm.environment.set(\"siguiente_pagina\", meta.current_page + 1);",
									"} else {",
									"    pm.environment.set(\"tiene_mas_paginas\", false);",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_admin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token_super}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/worklog?page=1&per_page=15",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"worklog"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "per_page",
									"value": "15"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_22 ACCESOS CON ROL NO AUTORIZADO",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Acceso denegado a bitÃ¡cora para usuario sin permisos\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([401, 403]);",
									"});",
									"",
									"let body = {};",
									"try {",
									"    body = pm.response.json();",
									"} catch (e) {}",
									"",
									"if (body.message) {",
									"    pm.test(\"Mensaje indica falta de permisos\", function () {",
									"        const msg = body.message.toLowerCase();",
									"        pm.expect(",
									"            msg.includes(\"no tiene permisos\") ||",
									"            msg.includes(\"forbidden\") ||",
									"            msg.includes(\"no autorizado\") ||",
									"            msg.includes(\"access denied\")",
									"        ).to.be.true;",
									"    });",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_secretaria}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token_super}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/worklog",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"worklog"
							]
						}
					},
					"response": []
				}
			],
			"description": "# Carpeta BITACORA\n\nEsta carpeta contiene solicitudes relacionadas con la gestiÃ³n de bitÃ¡coras. Incluye endpoints para listar bitÃ¡coras, filtrar por relevancia y fecha, paginar resultados y manejar accesos segÃºn roles. A continuaciÃ³n se documentan los endpoints incluidos, su propÃ³sito, mÃ©todos, parÃ¡metros y casos de uso.\n\n---\n\n## Endpoints incluidos\n\n### 1\\. **Listar BitÃ¡coras**\n\n- **Nombre:** CP_19 LISTAR BITACORAS\n    \n- **MÃ©todo:** `GET`\n    \n- **Endpoint:** `/worklog`\n    \n- **ParÃ¡metros:**\n    - Ninguno obligatorio.\n        \n- **DescripciÃ³n:** Obtiene el listado completo de bitÃ¡coras disponibles.\n    \n- **Caso de uso:** Visualizar todas las bitÃ¡coras registradas en el sistema.\n    \n\n---\n\n### 2\\. **Filtrar BitÃ¡coras por Relevancia**\n\n- **Nombre:** CP_20 FILTRAR POR RELEVANCIA\n    \n- **MÃ©todo:** `GET`\n    \n- **Endpoint:** `/worklog?relevance={{filtro_relevancia}}`\n    \n- **ParÃ¡metros:**\n    - `relevance` (query, string): Nivel de relevancia por el cual filtrar (ejemplo: \"alta\", \"media\", \"baja\").\n        \n- **DescripciÃ³n:** Permite filtrar el listado de bitÃ¡coras segÃºn el nivel de relevancia especificado.\n    \n- **Caso de uso:** Buscar bitÃ¡coras que requieren atenciÃ³n prioritaria o de un tipo especÃ­fico.\n    \n\n---\n\n### 3\\. **Filtrar BitÃ¡coras por Fecha**\n\n- **Nombre:** CP_20 FILTRAR LISTADO DE BITACORA\n    \n- **MÃ©todo:** `GET`\n    \n- **Endpoint:** `/worklog?date={{filtro_fecha}}`\n    \n- **ParÃ¡metros:**\n    - `date` (query, string): Fecha en formato `YYYY-MM-DD` para filtrar las bitÃ¡coras.\n        \n- **DescripciÃ³n:** Filtra las bitÃ¡coras por una fecha especÃ­fica.\n    \n- **Caso de uso:** Consultar bitÃ¡coras registradas en una fecha determinada.\n    \n\n---\n\n### 4\\. **PaginaciÃ³n de BitÃ¡coras**\n\n- **Nombre:** CP_21 PAGINACION DE LISTADO BITACORA\n    \n- **MÃ©todo:** `GET`\n    \n- **Endpoint:** `/worklog?page=1&per_page=15`\n    \n- **ParÃ¡metros:**\n    - `page` (query, integer): NÃºmero de pÃ¡gina a consultar.\n        \n    - `per_page` (query, integer): Cantidad de registros por pÃ¡gina.\n        \n- **DescripciÃ³n:** Permite obtener el listado de bitÃ¡coras de forma paginada.\n    \n- **Caso de uso:** Navegar por grandes volÃºmenes de bitÃ¡coras de manera eficiente.\n    \n\n---\n\n### 5\\. **Listar PÃ¡gina Siguiente de BitÃ¡cora**\n\n- **Nombre:** CP_21 LISTAR PAGINA SIGUIENTE BITACORA\n    \n- **MÃ©todo:** `GET`\n    \n- **Endpoint:** `/worklog?page=1&per_page=20`\n    \n- **ParÃ¡metros:**\n    - `page` (query, integer): NÃºmero de pÃ¡gina a consultar.\n        \n    - `per_page` (query, integer): Cantidad de registros por pÃ¡gina.\n        \n- **DescripciÃ³n:** Similar al anterior, permite consultar la siguiente pÃ¡gina de resultados.\n    \n- **Caso de uso:** Continuar la navegaciÃ³n por el listado de bitÃ¡coras.\n    \n\n---\n\n### 6\\. **Accesos con Rol No Autorizado**\n\n- **Nombre:** CP_22 ACCESOS CON ROL NO AUTORIZADO\n    \n- **MÃ©todo:** `GET`\n    \n- **Endpoint:** `/worklog`\n    \n- **ParÃ¡metros:**\n    - Ninguno obligatorio.\n        \n- **DescripciÃ³n:** Prueba el acceso al endpoint con un rol que no tiene permisos, para validar la seguridad.\n    \n- **Caso de uso:** Verificar que los roles no autorizados no puedan acceder a la informaciÃ³n de bitÃ¡coras.\n    \n\n---\n\n## Ejemplo de uso de parÃ¡metros\n\n``` http\nGET /worklog?relevance=alta\nGET /worklog?date=2024-06-01\nGET /worklog?page=2&per_page=15\n\n ```\n\n## Notas\n\n- Todos los endpoints requieren autenticaciÃ³n previa.\n    \n- Los parÃ¡metros pueden combinarse para realizar bÃºsquedas mÃ¡s especÃ­ficas.\n    \n- El manejo de roles es fundamental para la seguridad de los datos."
		},
		{
			"name": "TIPO DE GRUPOS",
			"item": [
				{
					"name": "LOGIN CORRECTO DIRECTOR COPY",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.variables.set(\"login_role\", \"director\");",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Login OK (200)\", () => pm.response.code === 200);\r",
									"\r",
									"const d = pm.response.json();\r",
									"const token =\r",
									"  d?.token ||\r",
									"  d?.access_token ||\r",
									"  d?.data?.token ||\r",
									"  d?.user?.api_token;\r",
									"\r",
									"pm.expect(token, \"No vino token en el body\").to.be.a(\"string\");\r",
									"pm.environment.set(\"token_director\", token);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"{{user_director}}\",\r\n  \"password\": \"{{pass_director}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_64 LISTAR TIPOS DE GRUPOS REGISTRADOS",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Test 1: Validate response status code is 200 OK",
									"pm.test(\"Status code is 200 OK\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"// Test 2: Validate response body is a valid JSON array",
									"pm.test(\"Response body is a valid JSON array\", function () {",
									"    pm.response.to.be.json;",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.be.an('array');",
									"});",
									"",
									"",
									"// Test 4: Verify response headers",
									"pm.test(\"Response has required headers\", function () {",
									"    pm.response.to.have.header(\"Content-Type\");",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");",
									"});",
									"",
									"pm.test(\"Response headers are valid\", function () {",
									"    // Check for common security and response headers",
									"    pm.response.to.have.header(\"Content-Type\");",
									"    ",
									"    // Optional: Check for other common headers if they exist",
									"    var headers = pm.response.headers;",
									"    if (headers.has(\"Content-Length\")) {",
									"        pm.expect(parseInt(headers.get(\"Content-Length\"))).to.be.above(0);",
									"    }",
									"});",
									"",
									"// Test 5: Check response time is within acceptable range",
									"pm.test(\"Response time is within acceptable range (< 2000ms)\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(2000);",
									"});",
									"",
									"pm.test(\"Response time is reasonable (< 5000ms)\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(5000);",
									"});",
									"",
									"// Additional validation: Check for data consistency",
									"pm.test(\"Group type IDs are unique\", function () {",
									"    var jsonData = pm.response.json();",
									"    ",
									"    if (jsonData.length > 0) {",
									"        var ids = jsonData.map(function(groupType) {",
									"            return groupType.id;",
									"        });",
									"        ",
									"        var uniqueIds = [...new Set(ids)];",
									"        pm.expect(uniqueIds.length).to.equal(ids.length, \"All group type IDs should be unique\");",
									"    }",
									"});",
									"",
									"// Store data for use in other requests if needed",
									"var responseData = pm.response.json();",
									"if (responseData.length > 0) {",
									"    pm.collectionVariables.set(\"groupTypeId\", responseData[0].id);",
									"    pm.collectionVariables.set(\"groupTypeName\", responseData[0].name);",
									"    console.log(\"Stored first group type - ID: \" + responseData[0].id + \", Name: \" + responseData[0].name);",
									"}"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Auto-refresh token if expired or missing",
									"const tokenAdmin = pm.environment.get(\"token_admin\");",
									"const tokenExpiry = pm.environment.get(\"token_admin_exp\");",
									"const currentTime = Date.now();",
									"",
									"// Check if token is missing or expired",
									"const isTokenExpired = !tokenExpiry || currentTime >= parseInt(tokenExpiry);",
									"const isTokenMissing = !tokenAdmin;",
									"",
									"if (isTokenMissing || isTokenExpired) {",
									"    console.log(\"Token is missing or expired. Fetching new token...\");",
									"    ",
									"    // Get login credentials from environment",
									"    const baseUrl = pm.environment.get(\"base_url\");",
									"    const email = pm.environment.get(\"email\");",
									"    const password = pm.environment.get(\"password\");",
									"    ",
									"    if (!email || !password) {",
									"        console.error(\"Login credentials (email/password) not found in environment variables\");",
									"        return;",
									"    }",
									"    ",
									"    // Make login request to get fresh token",
									"    try {",
									"        const loginResponse = await pm.sendRequest({",
									"            url: `${baseUrl}/auth/login`,",
									"            method: \"POST\",",
									"            header: {",
									"                \"Content-Type\": \"application/json\",",
									"                \"Accept\": \"application/json\"",
									"            },",
									"            body: {",
									"                mode: \"raw\",",
									"                raw: JSON.stringify({",
									"                    email: email,",
									"                    password: password",
									"                })",
									"            }",
									"        });",
									"        ",
									"        if (loginResponse.code === 200) {",
									"            const responseData = loginResponse.json();",
									"            ",
									"            // Extract token from response (adjust path based on your API response structure)",
									"            const newToken = responseData.token || responseData.access_token || responseData.data?.token;",
									"            ",
									"            if (newToken) {",
									"                // Store the new token",
									"                pm.environment.set(\"token_admin\", newToken);",
									"                ",
									"                // Set expiry time (default 1 hour if not provided by API)",
									"                const expiresIn = responseData.expires_in || 3600; // seconds",
									"                const expiryTime = Date.now() + (expiresIn * 1000);",
									"                pm.environment.set(\"token_admin_exp\", expiryTime.toString());",
									"                ",
									"                console.log(\"Token refreshed successfully\");",
									"            } else {",
									"                console.error(\"Token not found in login response\");",
									"            }",
									"        } else {",
									"            console.error(\"Login failed with status code:\", loginResponse.code);",
									"        }",
									"    } catch (error) {",
									"        console.error(\"Error during token refresh:\", error);",
									"    }",
									"} else {",
									"    console.log(\"Token is still valid\");",
									"}"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_director}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token_admin}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/groupTypes",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"groupTypes"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_69 REGISTRAR GRUPO EN CARGA ACADEMICA",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ======================================================\r",
									"// GENERAR CÃ“DIGO ÃšNICO PARA GRUPO\r",
									"// ======================================================\r",
									"pm.variables.set(\"codigo_grupo\", \"G\" + pm.variables.get(\"randomCode\"));\r",
									"console.log(\"CÃ³digo generado para grupo:\", pm.variables.get(\"codigo_grupo\"));\r",
									"\r",
									"// Si no existe la variable, inicialÃ­zala\r",
									"if (!pm.environment.get(\"course_id_incremental\")) {\r",
									"    pm.environment.set(\"course_id_incremental\", 1); // o el valor inicial que desees\r",
									"}\r",
									"\r",
									"// ObtÃ©n el valor actual\r",
									"let currentCourseId = parseInt(pm.environment.get(\"course_id_incremental\"), 10);\r",
									"\r",
									"// Asigna el valor a una variable de entorno temporal para usar en el body\r",
									"pm.environment.set(\"current_course_id\", currentCourseId);\r",
									"\r",
									"// Incrementa para la siguiente iteraciÃ³n\r",
									"pm.environment.set(\"course_id_incremental\", currentCourseId + 1);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Test: CÃ³digo de estado esperado (201 para Ã©xito, 400 para error de grupo duplicado)",
									"pm.test(\"Status code is 201 (creado) o 400 (grupo duplicado)\", function () {",
									"    pm.expect([201, 400, 200]).to.include(pm.response.code);",
									"});",
									"",
									"",
									"// Test: Respuesta de error por grupo duplicado",
									"if (pm.response.code === 400) {",
									"    pm.test(\"Mensaje de error por grupo duplicado\", function () {",
									"        pm.expect(pm.response.text()).to.include(\"ya existe un grupo registrado con ese numero de grupo registrado en el sistema\");",
									"    });",
									"}"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_director}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token_director}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"number\": 15,\r\n  \"group_type_id\": 1,\r\n  \"course_id\": {{current_course_id}},\r\n  \"details\": [\r\n    {\r\n      \"day\": \"Lunes\",\r\n      \"start_hour\": \"08:00\",\r\n      \"finish_hour\": \"10:00\",\r\n      \"classroom\": \"Aula 101\"\r\n    }\r\n  ],\r\n  \"modality\": \"Presencial\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/academicLoad/1/groups",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"academicLoad",
								"1",
								"groups"
							]
						}
					},
					"response": []
				},
				{
					"name": "CP_70 â€“ ASIGNAR PROFESOR A GRUPO",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ======================================================\r",
									"// REEMPLAZAR ID DE GRUPO Y PROFESOR\r",
									"// ======================================================\r",
									"let groupId = pm.environment.get(\"group_id\") || 1;\r",
									"let profesorId = pm.environment.get(\"professor_id\") || 25; // Cambiar si tu backend usa otro ID\r",
									"\r",
									"pm.variables.set(\"createdGroupId\", groupId);\r",
									"pm.variables.set(\"profesorId\", profesorId);\r",
									"\r",
									"console.log(\"ðŸ‘¨â€ðŸ« Asignando profesor ID:\", profesorId, \"al grupo ID:\", groupId);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log(\"ðŸ‘¨â€ðŸ« Ejecutando CP_70 â€“ Asignar profesor a grupo\");\r",
									"\r",
									"pm.test(\"CÃ³digo 200 OK o 422\", () => {\r",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 422]);\r",
									"});\r",
									"\r",
									"if (pm.response.code === 200) {\r",
									"    console.log(\"âœ… Profesor asignado correctamente.\");\r",
									"} else {\r",
									"    const res = pm.response.json();\r",
									"    console.warn(\"âš ï¸ No se pudo asignar profesor:\", res.message);\r",
									"}\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token_director}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token_admin}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"people_id\": 25\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/groups/{{createdGroupId}}/professor",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"groups",
								"{{createdGroupId}}",
								"professor"
							]
						}
					},
					"response": []
				}
			],
			"description": "Esta carpeta contiene solicitudes para la gestiÃ³n de tipos de grupos en el sistema acadÃ©mico. Incluye los siguientes endpoints: listar los tipos de grupos registrados, registrar un grupo en una carga acadÃ©mica y asignar un profesor a un grupo especÃ­fico. Utiliza estos endpoints para administrar la estructura y asignaciones de grupos dentro del sistema."
		},
		{
			"name": "EMPLEADO",
			"item": []
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{token}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					"// ===== Helpers =====\r",
					"function g(k){ return pm.environment.get(k); }\r",
					"function s(k,v){ pm.environment.set(k,v); }\r",
					"function base(){ return (g(\"base_url\") || \"\").replace(/\\/+$/,''); }\r",
					"\r",
					"// No interferir con el propio login\r",
					"const urlStr = pm.request.url.toString();\r",
					"if (/\\/auth\\/login(\\b|\\/|\\?)/i.test(urlStr)) {\r",
					"  // Headers comunes (aunque sea login)\r",
					"  setCommonHeaders();\r",
					"  return;\r",
					"}\r",
					"\r",
					"// Rol efectivo (puede sobreescribirse en carpeta o request)\r",
					"const role = (pm.variables.get(\"role\") || g(\"role\") || \"admin\").toString().trim().toLowerCase();\r",
					"\r",
					"// Mapeo por rol -> usuario, pass y token a usar/guardar\r",
					"const cfgByRole = {\r",
					"  \"admin\":      { userKey: \"user_admin\",      passKey: \"pass_admin\",      tokenKey: \"token_admin\" },\r",
					"  \"secretaria\": { userKey: \"user_secretaria\", passKey: \"pass_secretaria\", tokenKey: \"token_secretaria\" },\r",
					"  \"rrhh\":       { userKey: \"user_rrhh\",       passKey: \"pass_rrhh\",       tokenKey: \"token_rrhh\" },\r",
					"  \"director\":   { userKey: \"user_director\",   passKey: \"pass_director\",   tokenKey: \"token_director\" },\r",
					"  \"candidato\":  { userKey: \"user_candidato\",  passKey: \"pass_candidato\",  tokenKey: \"token_candidato\" }\r",
					"};\r",
					"\r",
					"const cfg = cfgByRole[role] || cfgByRole[\"admin\"];\r",
					"const email = g(cfg.userKey);\r",
					"const pass  = g(cfg.passKey);\r",
					"const tokK  = cfg.tokenKey;\r",
					"\r",
					"function putBearer(token){\r",
					"  try { pm.request.headers.remove(\"Authorization\"); } catch(e){}\r",
					"  pm.request.headers.add({ key: \"Authorization\", value: `Bearer ${token}` });\r",
					"}\r",
					"\r",
					"function setCommonHeaders(){\r",
					"  // Accept siempre JSON\r",
					"  try { pm.request.headers.remove(\"Accept\"); } catch(e){}\r",
					"  pm.request.headers.add({ key: \"Accept\", value: \"application/json\" });\r",
					"\r",
					"  // Content-Type si el body es raw JSON\r",
					"  const hasBody = [\"POST\",\"PUT\",\"PATCH\"].includes(pm.request.method);\r",
					"  const isRaw   = pm.request.body && pm.request.body.mode === \"raw\";\r",
					"  if (hasBody && isRaw) {\r",
					"    try { pm.request.headers.remove(\"Content-Type\"); } catch(e){}\r",
					"    pm.request.headers.add({ key: \"Content-Type\", value: \"application/json\" });\r",
					"  }\r",
					"\r",
					"  // Header de versiÃ³n de contrato si existe\r",
					"  const cv = g(\"contractVersion\");\r",
					"  if (cv) {\r",
					"    try { pm.request.headers.remove(\"X-Contract-Version\"); } catch(e){}\r",
					"    pm.request.headers.add({ key: \"X-Contract-Version\", value: String(cv) });\r",
					"  }\r",
					"}\r",
					"\r",
					"// 1) Si ya hay token cacheado para ese rol, Ãºsalo\r",
					"const tokenCached = g(tokK);\r",
					"if (tokenCached) {\r",
					"  putBearer(tokenCached);\r",
					"  setCommonHeaders();\r",
					"  return;\r",
					"}\r",
					"\r",
					"// 2) Si no hay token, intentamos login rÃ¡pido\r",
					"if (!email || !pass || !base()) {\r",
					"  console.warn(`[AUTH][${role}] Faltan base_url o credenciales en el Environment.`);\r",
					"  setCommonHeaders();\r",
					"  return;\r",
					"}\r",
					"\r",
					"const loginUrl = `${base()}/auth/login`;\r",
					"\r",
					"pm.sendRequest({\r",
					"  url: loginUrl,\r",
					"  method: \"POST\",\r",
					"  header: { \"Accept\":\"application/json\", \"Content-Type\":\"application/json\" },\r",
					"  body: { mode:\"raw\", raw: JSON.stringify({ email, password: pass }) }\r",
					"}, (err, res) => {\r",
					"  if (err || !res) {\r",
					"    console.warn(`[AUTH][${role}] Error en login:`, err);\r",
					"    return setCommonHeaders();\r",
					"  }\r",
					"  if (!(res.code >= 200 && res.code < 300)) {\r",
					"    console.warn(`[AUTH][${role}] Login no OK. code=`, res.code);\r",
					"    return setCommonHeaders();\r",
					"  }\r",
					"\r",
					"  // Intentamos extraer token desde varias formas\r",
					"  let token = null;\r",
					"  try {\r",
					"    const d = res.json();\r",
					"    token = d?.token || d?.access_token || d?.data?.token || d?.api_token || d?.user?.api_token;\r",
					"  } catch(e){ /* ignore */ }\r",
					"\r",
					"  if (!token) {\r",
					"    const h = res.headers && res.headers.get(\"Authorization\");\r",
					"    if (h && /^Bearer\\s+/i.test(h)) token = h.replace(/^Bearer\\s+/i, \"\").trim();\r",
					"  }\r",
					"\r",
					"  if (!token) {\r",
					"    console.warn(`[AUTH][${role}] No se recibiÃ³ 'token' en la respuesta de login.`);\r",
					"    return setCommonHeaders();\r",
					"  }\r",
					"\r",
					"  // Cacheamos y aplicamos al request actual\r",
					"  s(tokK, token);\r",
					"  putBearer(token);\r",
					"  console.log(`[AUTH][${role}] Token listo e inyectado.`);\r",
					"  setCommonHeaders();\r",
					"});\r",
					"\r",
					"\r",
					"// ======================================================\r",
					"// VARIABLES DE FECHA / IDENTIFICADORES ÃšNICOS\r",
					"// ======================================================\r",
					"pm.variables.set(\"timestamp\", Date.now());\r",
					"pm.variables.set(\"randomCode\", \"AUTO\" + Math.floor(Math.random() * 10000));"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "groupTypeId",
			"value": ""
		},
		{
			"key": "groupTypeName",
			"value": ""
		}
	]
}